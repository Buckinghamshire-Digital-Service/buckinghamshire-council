{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Buckinghamshire Council Technical Documentation","text":""},{"location":"#project-overview","title":"Project overview","text":"<p>Buckinghamshire Council is a new unitary council formed from the five previous county and district councils in Buckinghamshire.</p> <p>This project is primarily a CMS. During the initial phase, when the council is first inaugurated, it will serve a mixture of content written specially for the new council, and links to the previous councils' pages where services differ on a local basis.</p> <p>Other features include:</p> <ul> <li>a job listings portal,</li> <li>a live chat client,</li> <li>an integration for complaints and request forms.</li> </ul>"},{"location":"#setting-up-a-local-build","title":"Setting up a local build","text":"<p>This repository includes <code>docker-compose</code> configuration for running the project in local Docker containers, and a fabfile for provisioning and managing this.</p> <p>There are a number of other commands to help with development using the fabric script. To see them all, run:</p> <pre><code>fab -l\n</code></pre>"},{"location":"#dependencies","title":"Dependencies","text":"<p>The following are required to run the local environment. The minimum versions specified are confirmed to be working: if you have older versions already installed they may work, but are not guaranteed to do so.</p> <ul> <li>Docker, version 19.0.0 or up</li> <li>Docker Desktop for Mac installer</li> <li>Docker Engine for Linux installers</li> <li>Docker Compose, version 1.24.0 or up</li> <li>Install instructions (Linux-only: Compose is already installed for Mac users as part of Docker Desktop.)</li> <li>Fabric, version 2.4.0 or up</li> <li>Install instructions</li> <li>Python, version 3.6.9 or up</li> </ul> <p>Note that on Mac OS, if you have an older version of fabric installed, you may need to uninstall the old one and then install the new version with pip3:</p> <pre><code>pip uninstall fabric\npip3 install fabric\n</code></pre> <p>You can manage different python versions by setting up <code>pyenv</code>: https://realpython.com/intro-to-pyenv/</p> <p>Additionally, for interacting with production / staging environments, you'll need:</p> <ul> <li>Heroku CLI</li> <li>AWS CLI</li> </ul>"},{"location":"#running-the-local-build-for-the-first-time","title":"Running the local build for the first time","text":"<p>If you are using Docker Desktop, ensure the Resources:File Sharing settings allow the cloned directory to be mounted in the web container (avoiding <code>mounting</code> OCI runtime failures at the end of the build step).</p> <p>Starting a local build can be done by running:</p> <pre><code>git clone git@git.torchbox.com:buckinghamshire-council/bc.git\ncd bc\nfab build\nfab migrate\nfab start\n</code></pre> <p>This will start the containers in the background, but not Django. To do this, connect to the web container with <code>fab sh</code> and run <code>honcho start</code> to start both Django and the Webpack dev server in the foreground.</p> <p>Then, connect to the running container again (<code>fab sh</code>) and:</p> <pre><code>dj createcachetable\ndj createsuperuser\n</code></pre> <p>The site should be available on the host machine at: http://127.0.0.1:8000/</p> <p>If you only wish to run the frontend or backend tooling, the commands <code>honcho</code> runs are in <code>docker/Procfile</code>.</p> <p>Upon first starting the container, the static files may not exist, or may be out of date. To resolve this, simply run <code>npm run build</code>.</p>"},{"location":"#front-end-assets","title":"Front-end Assets","text":"<p>After any change to the CSS or Javascript, you will need to run the build command, either in the VM or on your host machine. See the Front-end tooling docs for further details.</p>"},{"location":"#adding-documentation","title":"Adding documentation","text":"<p>The navigational index of the documentation files is defined in the <code>mkdocs.yml</code> file. Add any new markdown files to that index. You can also link directly to files where necessary, using markdown formatting and relative URLs.</p>"},{"location":"#external-integrations","title":"External Integrations","text":"<ul> <li>The jobs portal will work with Lumesse. Please see the recruitment site documentation for details.</li> <li>The live chat client is provided by Client4Access.</li> <li>Complaints and request forms features is based on the Aptean Respond case management platform.</li> <li>Location maps widget is based on the Google Maps API.</li> </ul>"},{"location":"#unique-features","title":"Unique features","text":"<ul> <li> <p>This project uses a custom implementation of Wagtail's form builder, located in the <code>bc.forms</code> app. It adds a new management command called <code>stale_submissions</code> which is meant to be run daily on the server (with its <code>--delete</code> flag). This command will delete submissions for forms which are configured for it.</p> </li> <li> <p>It also comes with a custom <code>EmbeddedFormBlock</code> streamfield block that lets editors embed forms from a <code>FormPage</code> inside another page.</p> </li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>To contribute to this project, please review the notes on contributing.</p>"},{"location":"CHANGELOG/","title":"Release History","text":""},{"location":"CHANGELOG/#881-2025-10-06","title":"88.1 (2025-10-06)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/88.0...88.1</p> <ul> <li>Fix footer link on blog homepage</li> <li>Update documentation about <code>GOOGLE_MAPS_V3_APIKEY</code></li> </ul>"},{"location":"CHANGELOG/#880-2025-09-30","title":"88.0 (2025-09-30)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/87.1...88.0</p> <ul> <li>Upgrade to Wagtail 7.0.3 (via 6.4.2)</li> </ul>"},{"location":"CHANGELOG/#871-2025-09-02","title":"87.1 (2025-09-02)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/87.0...87.1</p> <ul> <li> <p>Add configuration option to be able to set CSP_DEFAULT_SRC=None</p> </li> <li> <p>Upgrade to Wagtail 7.0.2 (via 6.4.2)</p> </li> </ul>"},{"location":"CHANGELOG/#870-2025-07-01","title":"87.0 (2025-07-01)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/86.0...87.0</p> <ul> <li>Add configuration option for CSP_FRAME_ANCESTORS</li> </ul>"},{"location":"CHANGELOG/#860-2025-04-29","title":"86.0 (2025-04-29)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/85.0...86.0</p> <ul> <li>Add Silktide as a cookie consent manager</li> <li>Remove old cookie consent manager</li> <li>Remove (unused) Fathom analytics</li> </ul>"},{"location":"CHANGELOG/#850-2025-03-17","title":"85.0 (2025-03-17)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/84.0...85.0</p> <ul> <li>Fix alignment in steps block</li> <li>Add management command for deleting old form submissions</li> <li>Restrict form submissions to specific groups</li> <li>Add embeddable form block</li> </ul>"},{"location":"CHANGELOG/#840-2025-03-12","title":"84.0 (2025-03-12)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/83.1...84.0</p> <ul> <li>Accessibility fixes for accordions and footer link</li> <li>Switch GIS provider for BucksMapsClient to maps.buckinghamshire.gov.uk</li> <li>Add <code>WAGTAILSEARCH_HITS_MAX_AGE</code> setting to use in conjunction with <code>searchpromotions_garbage_collect</code> management command.</li> <li>Change accordions' headers from h2 to h3</li> <li>Reduce height of formbuilder's multiline text boxes (5 -&gt; 3 lines)</li> <li>Restore ability to specify choices by lines (instead of comma-separated) for multi-checkbox formbuilder fields</li> <li>Add H4 level blocks to BaseStoryBlock</li> </ul>"},{"location":"CHANGELOG/#831-2025-03-03","title":"83.1 (2025-03-03)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/83.0...83.1</p> <ul> <li>Add support for hidden until-found attr in accordion and steps styles</li> </ul>"},{"location":"CHANGELOG/#830-2025-03-03","title":"83.0 (2025-03-03)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.9...83.0</p> <ul> <li>Make content searchable in accordions</li> <li>Fix alignment of plain text tables</li> <li>Add missing label to form field</li> <li>Fix unstructured headings when using tables</li> <li>Fix a11y issues from Silktide</li> <li>Fix missing content after headings</li> <li>Add missing aria labels to sidebars and postcode lookup search</li> <li>Add missing aria label to the FIS card block</li> </ul>"},{"location":"CHANGELOG/#829-2025-01-08","title":"82.9 (2025-01-08)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.8...82.9</p> <ul> <li>Upgrade to Wagtail 6.3</li> <li>Upgrade node version from v12 to v20</li> </ul>"},{"location":"CHANGELOG/#828-2025-01-08","title":"82.8 (2025-01-08)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.7...82.8</p> <ul> <li>Upgrade Wagtail to v6.2</li> </ul>"},{"location":"CHANGELOG/#827-2024-11-29","title":"82.7 (2024-11-29)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.6...82.7</p> <ul> <li>FE: Fix spacing between rich-text and callout block</li> </ul>"},{"location":"CHANGELOG/#826-2024-11-28","title":"82.6 (2024-11-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.5...82.6</p> <ul> <li>FE: Reinstate breadcrumb on non-fostering event index pages</li> </ul>"},{"location":"CHANGELOG/#825-2024-11-28","title":"82.5 (2024-11-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.4...82.5</p> <ul> <li>FE: Post-launch enhancements</li> </ul>"},{"location":"CHANGELOG/#824-2024-11-27","title":"82.4 (2024-11-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.3...82.4</p> <ul> <li>Add setting to limit max image size</li> </ul>"},{"location":"CHANGELOG/#823-2024-11-25","title":"82.3 (2024-11-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.2...82.3</p> <ul> <li>FE: Fix heading hierarchy</li> </ul>"},{"location":"CHANGELOG/#822-2024-11-25","title":"82.2 (2024-11-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.1...82.2</p> <ul> <li>FE: A11y fix for hero button</li> </ul>"},{"location":"CHANGELOG/#821-2024-11-25","title":"82.1 (2024-11-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/82.0...82.1</p> <ul> <li>FE: Fix SF stacking</li> </ul>"},{"location":"CHANGELOG/#820-2024-11-25","title":"82.0 (2024-11-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/81.1...82.0</p> <ul> <li>Various FE fixes/updates</li> <li>Add description field to the <code>EventIndexPage</code></li> <li>Update the <code>hero--promo-blog.html</code> molecule to display a description in both the the <code>BlogHomePage</code> and <code>EventIndexPage</code> hero</li> </ul>"},{"location":"CHANGELOG/#811-2024-11-21","title":"81.1 (2024-11-21)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/81.0...81.1</p> <ul> <li>Various FE fixes/updates</li> <li>Replace the <code>hero_link_page</code> and <code>hero_link_text</code> fields of a Promotional Content page with the <code>LinkBlock</code> from the <code>bc.utils.blocks</code> module</li> <li>Replace the <code>link_page</code> and <code>link_text</code> fields with of the CalloutWithImage Block with a LinkBlock from the <code>bc.utils.blocks</code> module</li> <li>Update Promotional Content LinkCard block to allow more field choices (<code>internal_link</code>, <code>external_link</code>, <code>email</code> or a <code>phone_number</code>)</li> <li>Add <code>phonenumberlite</code> (version 8.13.50+) dependency to the project</li> <li>Add PhoneNumberBlock to the Promotional Content blocks module</li> </ul>"},{"location":"CHANGELOG/#810-2024-11-14","title":"81.0 (2024-11-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/80.2...81.0</p> <ul> <li> <p>Add promotional site page types</p> </li> <li> <p>Bump Node.js from v12 to v14</p> </li> <li>Wagtail 6.1 upgrade</li> </ul>"},{"location":"CHANGELOG/#802-2024-11-11","title":"80.2 (2024-11-11)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/80.1...80.2</p> <ul> <li>upgrade python to 3.11</li> </ul>"},{"location":"CHANGELOG/#801-2024-10-15","title":"80.1 (2024-10-15)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/80.0...80.1</p> <ul> <li>Update Redis config to use up-to-date Torchbox standard, including compatibility with Heroku's Redis services (which use self-signed certificates for secure connections)</li> <li>Update local dev config to match Heroku version</li> </ul>"},{"location":"CHANGELOG/#800-2024-10-08","title":"80.0 (2024-10-08)","text":"<ul> <li>Fix panels on category page</li> <li>Update wycombe url for school hub</li> </ul>"},{"location":"CHANGELOG/#790-2024-08-20","title":"79.0 (2024-08-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/78.2...79.0</p> <ul> <li>EHCCo widget: Update widget heading text</li> <li>EHCCo widget: Make emails clickable by converting them to links</li> <li>EHCCo widget: Change fallback text from TBC to awaiting allocation</li> <li>Add option to display images for first three pages in category page</li> </ul>"},{"location":"CHANGELOG/#782-2024-08-14","title":"78.2 (2024-08-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/78.1...78.2</p> <ul> <li>Fix ehcco api calls being made to the wrong endpoint</li> </ul>"},{"location":"CHANGELOG/#781-2024-08-13","title":"78.1 (2024-08-13)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/78.0...78.1</p> <ul> <li>Don't cache WasteWizardPages, as they need to be cookie-sensitive</li> </ul>"},{"location":"CHANGELOG/#780-2024-08-13","title":"78.0 (2024-08-13)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/77.0...78.0</p> <ul> <li>Directory search block (Merge request #712)</li> <li>Directory services block (Merge request #727)</li> </ul>"},{"location":"CHANGELOG/#770-2024-07-29","title":"77.0 (2024-07-29)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/76.0...77.0</p> <ul> <li>Wagtail 6.1 upgrade</li> </ul>"},{"location":"CHANGELOG/#760-2024-07-23","title":"76.0 (2024-07-23)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/75.0...76.0</p> <ul> <li>Change div to section on cards_block.html to prevent aria-label warning</li> <li>Remove search-header--fis</li> </ul>"},{"location":"CHANGELOG/#750-2024-07-10","title":"75.0 (2024-07-10)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/74.0...75.0</p> <ul> <li>Reinstate removed header styles</li> <li>Make header height uniform across all pages in fis site</li> </ul>"},{"location":"CHANGELOG/#740-2024-07-10","title":"74.0 (2024-07-10)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/73.0...74.0</p> <ul> <li>Update FIS search in header - remove dropdown search and simplify to single text input, consistent with the standard homepage</li> <li>Add transparent border to search inputs to improve visibility of input boundary in high contrast mode</li> </ul>"},{"location":"CHANGELOG/#730-2024-07-09","title":"73.0 (2024-07-09)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/72.01...73.0</p> <ul> <li>Add new search promotional block on search page</li> <li>Add FIS EHCCo search</li> <li>Modify FIS search results view</li> <li>Modify FIS homepage</li> <li>Modify FIS category index page</li> <li>Fix accessibility issues from Silktide</li> </ul>"},{"location":"CHANGELOG/#7201-2024-06-26","title":"72.01 (2024-06-26)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/72.00...72.01</p> <ul> <li>Wagtail 6.0 upgrade fix add classname to include for patterns/atoms/icons/icon.html</li> </ul>"},{"location":"CHANGELOG/#7200-2024-06-25","title":"72.00 (2024-06-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/71.01...72.00</p> <ul> <li>Update link block component to always display list items for all screen sizes (following user testing feedback)</li> <li>Accessibility fix: page does not start with a h1</li> <li>Accessibility fix: aria-label not allowed on subpages div</li> <li>Accessibility fix: heading order not correct for footer column headings</li> </ul>"},{"location":"CHANGELOG/#7101-2024-06-17","title":"71.01 (2024-06-17)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/71.00...71.01</p> <ul> <li>Validate Talentlink-imported images as if uploaded through the Wagtail admin</li> </ul>"},{"location":"CHANGELOG/#7100-2024-06-03","title":"71.00 (2024-06-03)","text":"<p>Wagtail 6.0 upgrade</p> <p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/70.01...71.00</p>"},{"location":"CHANGELOG/#7001-2024-04-03","title":"70.01 (2024-04-03)","text":"<ul> <li>Update <code>flake8</code> to version 3.8.4 for Python 3.8 compatibility</li> <li>Fix <code>global_vars</code> context processor when no default site is set</li> </ul> <p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/70.01...70.00</p>"},{"location":"CHANGELOG/#7000-2024-03-18","title":"70.00 (2024-03-18)","text":"<p>Wagtail 5.2 and Django 4.2 upgrade</p> <p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/70.00...69.14</p>"},{"location":"CHANGELOG/#6914-2024-02-05","title":"69.14 (2024-02-05)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.13...69.14</p> <ul> <li>Add a DateRangeFilter to the FeedbackCommentReportView and UsefulnessFeedbackReportView</li> </ul>"},{"location":"CHANGELOG/#6913-2024-01-08","title":"69.13 (2024-01-08)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.12...69.13</p> <ul> <li>Update cookie message to hide from devices which have previously declined cookies.</li> </ul>"},{"location":"CHANGELOG/#6912-2023-11-27","title":"69.12 (2023-11-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.11...69.12</p> <ul> <li>Bump wagtail version to 5.0.5</li> </ul>"},{"location":"CHANGELOG/#6911-2023-11-27","title":"69.11 (2023-11-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.10...69.11</p> <ul> <li>Add a template for the RedirectPage type</li> <li>Add a check for empty columns in the PieChartBlock</li> <li>Add a Retry to the BucksMapsClient</li> <li>Upgrade Wagtail to 5.0</li> </ul>"},{"location":"CHANGELOG/#6910-2023-10-24","title":"69.10 (2023-10-24)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.9...69.10</p> <ul> <li>Update Waste Wizard api url</li> </ul>"},{"location":"CHANGELOG/#699-2023-10-23","title":"69.9 (2023-10-23)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.8...69.9</p> <ul> <li>Use nvm to install Node.js</li> <li>Add fix for object has no attribute 'is_preview'</li> </ul>"},{"location":"CHANGELOG/#698-2023-10-06","title":"69.8 (2023-10-06)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.7...69.8</p> <ul> <li>Fixes for Google spam issue</li> </ul>"},{"location":"CHANGELOG/#697-2023-09-21","title":"69.7 (2023-09-21)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.6...69.7</p> <ul> <li>Use the same Postgres version (v13.10) everywhere.</li> </ul>"},{"location":"CHANGELOG/#696-2023-09-05","title":"69.6 (2023-09-05)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.5...69.6</p> <ul> <li>Update Safe Spaces widget URLs</li> </ul>"},{"location":"CHANGELOG/#695-2023-08-30","title":"69.5 (2023-08-30)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.4...69.5</p> <ul> <li>Fix collectstatic error when running fab build by upgrading python to 3.8, debian image, poetry and psycopg2</li> </ul>"},{"location":"CHANGELOG/#694-2023-07-07","title":"69.4 (2023-07-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.3...69.4</p> <ul> <li>Upgrade Django to 3.2.20 for CVE-2023-36053</li> </ul>"},{"location":"CHANGELOG/#693-2023-06-07","title":"69.3 (2023-06-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.2...69.3</p> <ul> <li>Make RedirectPage redirect to target url when directly visited</li> </ul>"},{"location":"CHANGELOG/#692-2023-06-06","title":"69.2 (2023-06-06)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.1...69.2</p> <ul> <li>Wagtail 4.2 Upgrade</li> </ul>"},{"location":"CHANGELOG/#691-2023-05-02","title":"69.1 (2023-05-02)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/69.0...69.1</p> <ul> <li>Update table block to only convert explicitly formatted markdown links</li> </ul>"},{"location":"CHANGELOG/#690-2023-04-11","title":"69.0 (2023-04-11)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/68.1...69.0</p> <ul> <li>Create AwardsSnippet and update RecruitmentHomePage with a FK to the AwardsSnippet</li> <li>Define an IconChoice TextChoices model and update JobCategory with an <code>icon</code> field whose choices are <code>IconChoice.choices</code></li> <li>Update the <code>delete_docker_database</code> task in <code>fabfile.py</code> to create a <code>heroku_ext</code> schema. See Migrating Extensions to <code>heroku_ext</code> schema for more details.</li> <li>Replace awards with social media icons in Jobs page header</li> <li>Add FE for awards block</li> <li>Add FE for the benefits list</li> <li>Replace awards with social media icons in Jobs page header</li> <li>Add icons for category cards and update styles</li> <li>Restyle jobs page hero</li> <li>Add FE for job media block</li> <li>Add JobPlatformBlock, MediaBlock &amp; JobPlatformsMediaSnippet</li> <li>Add hero subtitle to RecruitmentHomePage,</li> <li>Update RecruitmentHomePage to display the first 6 children of a specified RecruitmentIndexPage.</li> <li>Update hero and card styles on job index page</li> </ul>"},{"location":"CHANGELOG/#681-2023-03-22","title":"68.1 (2023-03-22)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/68.0...68.1</p> <ul> <li>Fix rendering of chart blocks</li> </ul>"},{"location":"CHANGELOG/#680-2023-03-21","title":"68.0 (2023-03-21)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/67.1...68.0</p> <ul> <li>Add setting to add directory links for each site, removing the dependency on env variable</li> <li>Reorder collections sorted by name to fix error while adding new collections</li> <li>Add dark background with light color text to hero headings and subheadings</li> <li>Add link formatting options in table and change styles of typedtable</li> <li>Add h2 option to highlight block</li> <li>Remove category count related to unpublished pages</li> <li>Remove unpublished chapter pages from menu</li> <li>Fix issue of import page function close button missing after wagtail upgrade to 4.x.x</li> <li>Add backoff to search view</li> </ul>"},{"location":"CHANGELOG/#671-2023-01-31","title":"67.1 (2023-01-31)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/67.0...67.1</p> <ul> <li>Fix pages deployment https://git.torchbox.com/buckinghamshire-council/bc/-/merge_requests/555</li> <li>Update sentry https://git.torchbox.com/buckinghamshire-council/bc/-/merge_requests/575</li> </ul>"},{"location":"CHANGELOG/#670-2023-01-31","title":"67.0 (2023-01-31)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/66.0...67.0</p> <ul> <li>Add optional intro field to subsite home page</li> <li>Fix/Remove LGPS pages from BC council search results</li> <li>Add newsindex page to child pages list for display</li> <li>Change card content alignment from space-between to start</li> <li>Add index page as child page of all category page types</li> </ul>"},{"location":"CHANGELOG/#660","title":"66.0","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/65.1...66.0</p> <ul> <li>Upgrade wagtail v4.1</li> </ul>"},{"location":"CHANGELOG/#651-2023-01-25","title":"65.1 (2023-01-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/65.0...65.1</p> <ul> <li>Fix: Handle URLs longer than 200 characters in feedback comment form</li> </ul>"},{"location":"CHANGELOG/#650-2022-11-29","title":"65.0 (2022-11-29)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/64.0...65.0</p> <ul> <li>Change Homepage FieldPanels to MultiFieldPanels</li> <li>Add EventIndexPage and NewsIndex as child of SubsiteHomePage</li> <li>Display child pages of Inlineindex pages in search on mobile devices</li> <li>Add line between contents and body in InformationPage</li> <li>Allow alert page to be null, and add search fields for alert modeladmin</li> <li>Add RedirectPage type</li> <li>Add WasteWizardPage type and WasteWizardSnippet</li> <li>Add h2 to body rich text field</li> <li>Make banner fields optional, and editable search prompt text, and new category page with banner position setting</li> </ul>"},{"location":"CHANGELOG/#640-2022-10-19","title":"64.0 (2022-10-19)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/63.1...64.0</p> <ul> <li>Rename Family Information Service Homepage to Subsite Homepage</li> <li>Allow all subpage types to be created under Subsite Homepages</li> <li>Display child index pages on rendered Subsite home pages</li> <li>Synchronise docker-compose file version numbers</li> <li>Add list_creatable_pages management command</li> <li>Update parent_page_types and subpage_types attrs for many models</li> <li>Change functionality of listing title</li> <li>Make listing summary mandatory</li> <li>Remove draft blog pages from listing</li> <li>Modify location index and location page to have additional content</li> <li>Remove child policy pages from search</li> <li>Show child index pages as part of a larger section in search</li> <li>Add default social image for pages</li> </ul>"},{"location":"CHANGELOG/#631-2022-10-03","title":"63.1 (2022-10-03)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/63.0...63.1</p> <ul> <li>Add configurable timeout to Python client for maps.buckscc.gov.uk API</li> </ul>"},{"location":"CHANGELOG/#630-2022-09-27","title":"63.0 (2022-09-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/62.0...63.0</p> <ul> <li>A11y: Add <code>overflow-wrap</code> &amp; <code>word-break</code> CSS properties to <code>&lt;ul&gt;</code> &amp; <code>&lt;ol&gt;</code> elements to prevent text from overflowing its line box, causing problems particularly on smaller devices.</li> <li>A11y: Fix accessibility on Blog Home Page template by adding <code>listitem</code> role to <code>&lt;span&gt;</code> elements in unordered lists</li> <li>A11y: Add <code>&lt;h2&gt;</code> headings to the <code>introduction</code> RichTextField in the StepByStepPage model, thus allowing for creation of an accessible heading order.</li> </ul>"},{"location":"CHANGELOG/#620-2022-08-30","title":"62.0 (2022-08-30)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/-/merge_requests/574/diffs</p> <ul> <li>Wagtail 3.0 upgrade</li> <li>Support/birdbath flightpath</li> </ul>"},{"location":"CHANGELOG/#610-2022-08-09","title":"61.0 (2022-08-09)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/60.1...61.0</p> <ul> <li>Add <code>BlogAboutPage</code></li> <li>Prevent more <code>InformationPage</code>s from being added to the <code>BlogHomePage</code></li> <li>Allow the use of formatted table blocks and plain text table blocks in most pages</li> </ul>"},{"location":"CHANGELOG/#610-2022-08-09_1","title":"61.0 (2022-08-09)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/60.1...61.0</p> <ul> <li>Add <code>BlogAboutPage</code></li> <li>Prevent more <code>InformationPage</code>s from being added to the <code>BlogHomePage</code></li> <li>Allow the use of formatted table blocks and plain text table blocks in most pages</li> </ul>"},{"location":"CHANGELOG/#601-2022-07-27","title":"60.1 (2022-07-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/60.0...60.1</p> <ul> <li>Change dbs field label on jobs sidebar</li> </ul>"},{"location":"CHANGELOG/#600-2022-07-26","title":"60.0 (2022-07-26)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/59.0...60.0</p> <ul> <li>Remove bottom border from last section on sidebar</li> <li>Add button to decline cookies</li> <li>Change dbs_check from booleanfield to a textfield</li> <li>Add categories to blogs</li> <li>Add subscriptions to blogs</li> <li>Add Blog global homepage</li> </ul>"},{"location":"CHANGELOG/#590-2022-07-19","title":"59.0 (2022-07-19)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/58.0...59.0</p> <ul> <li>Add safe spaces banner to site footer</li> </ul>"},{"location":"CHANGELOG/#580-2022-07-04","title":"58.0 (2022-07-04)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/57.0...58.0</p> <ul> <li>Docker for development work https://git.torchbox.com/buckinghamshire-council/bc/-/merge_requests/522</li> </ul>"},{"location":"CHANGELOG/#570-2022-06-30","title":"57.0 (2022-06-30)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/56.0...57.0</p> <ul> <li>Add placeholder blog global homepage</li> </ul>"},{"location":"CHANGELOG/#560-2022-06-28","title":"56.0 (2022-06-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/55.0...56.0</p> <ul> <li>Add beacons for different steps throughout a job application</li> </ul>"},{"location":"CHANGELOG/#550-2022-06-28","title":"55.0 (2022-06-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/54.2...55.0</p> <ul> <li>Add model for <code>BlogHomePage</code> and corresponding template</li> <li>Add model and UI for <code>BlogPostPage</code></li> <li>Add backend for blogs search</li> <li>Add recent posts block to blog sidebar</li> <li>Add social media links to blog sidebars</li> <li>Add search bar for the blog site</li> <li>Add blogs list UI component</li> <li>Add filtered view - search results</li> <li>Add pagination on blog homepage</li> <li>Add featured blog post UI</li> <li>Fix blog listing border</li> <li>Add intro text to be displayed in blog home page listings</li> </ul>"},{"location":"CHANGELOG/#542-2022-06-28","title":"54.2 (2022-06-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/54.1...54.2</p> <ul> <li>Fix aria labels of buttons in pagination and local area link blocks</li> </ul>"},{"location":"CHANGELOG/#541-2022-05-23","title":"54.1 (2022-05-23)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/54.0...54.1</p> <ul> <li>Fix tables not showing horizontal lines between rows</li> <li>Add rich text and numeric options to typedtable</li> </ul>"},{"location":"CHANGELOG/#540-2022-05-12","title":"54.0 (2022-05-12)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/53.0...54.0</p> <ul> <li>Update Black to a newer version to fix _unicodefun linting issue. Also applied formatting on existing files.</li> <li>Add aligned columns to typedtable</li> <li>Add intro text field to several page types</li> <li>Make alert length 255 characters long (text only)</li> <li>Fix issues with hidden content being focusable</li> <li>Fix issues with form field not being labelled</li> <li>Migrate to heroku-deploy</li> </ul>"},{"location":"CHANGELOG/#530-2022-01-31","title":"53.0 (2022-01-31)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/52.1...53.0</p> <ul> <li>Prefix Sentry release variable with environment name, for easier debugging</li> <li>Add inset text component to StoryBlock</li> <li>Fix issues with job sitemap displaying jobs from other domains</li> </ul>"},{"location":"CHANGELOG/#521-2022-01-25","title":"52.1 (2022-01-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/52.0...52.1</p> <ul> <li>Fix location page referencing deleted sidebar template</li> </ul>"},{"location":"CHANGELOG/#520-2022-01-24","title":"52.0 (2022-01-24)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/51.0...52.0</p> <ul> <li>Add LocationIndex and Location pages</li> <li>Update documentation to summarise use of wagtail-geo-widget for maps</li> </ul>"},{"location":"CHANGELOG/#510-2022-01-20","title":"51.0 (2022-01-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/50.3...51.0</p> <ul> <li>Add 'Part of' section to sidebar for pages referenced by StepByStepPage</li> <li>Fix event datetime formats</li> <li>Add contents section with 'Scroll to top' feature for InformationPage</li> </ul>"},{"location":"CHANGELOG/#503-2022-01-11","title":"50.3 (2022-01-11)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/50.2...50.3</p> <ul> <li>Fix: Treat 'table' block values as TableBlock instances when nested in Accordion</li> </ul>"},{"location":"CHANGELOG/#502-2022-01-11","title":"50.2 (2022-01-11)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/50.1...50.2</p> <ul> <li>Fix alignment issue for tables where first column is a header</li> </ul>"},{"location":"CHANGELOG/#501-2022-01-07","title":"50.1 (2022-01-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/50.0...50.1</p> <ul> <li>Fix an issue with job searches by postcode, due to a query expression change in Django 3.2</li> </ul>"},{"location":"CHANGELOG/#500-2022-01-07","title":"50.0 (2022-01-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/49.0...50.0</p> <ul> <li>Upgrade Wagtail to 2.15.1, Django to 3.2.9, django-pattern-library to 0.5,   django-redis to 4.11.0, factory-boy to 3.2.1, freezegun to 1.1.0, responses to 0.16.0,   wagtail-factories to 2.0.1, and whitenoise to 5.0; and replace deprecated &amp; removed   functions &amp; fields</li> <li>Upgrade TableBlock to TypedTableBlock</li> <li>Update data protection docs with an extra table to anonymise</li> </ul>"},{"location":"CHANGELOG/#490-2021-12-17","title":"49.0 (2021-12-17)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/48.0...49.0</p> <ul> <li>StepByStepPage \u2014 Change body of each step to a RichTextField</li> </ul>"},{"location":"CHANGELOG/#480-2021-12-14","title":"48.0 (2021-12-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/47.0...48.0</p> <ul> <li>Add TIDE winners logo to Jobs site header</li> </ul>"},{"location":"CHANGELOG/#470-2021-12-01","title":"47.0 (2021-12-01)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/46.0...47.0</p> <ul> <li>Postcode Lookup \u2014 Update the area links block UI to permit only querying by postcode</li> <li>Postcode Lookup \u2014 Remove local area links lists from search results</li> <li>Postcode Lookup \u2014 Use the internal Buckinghamshire maps API</li> <li>Postcode Lookup \u2014 Query additional address data for border postcodes</li> <li>Postcode Lookup \u2014 Update documentation</li> </ul>"},{"location":"CHANGELOG/#460-2021-11-29","title":"46.0 (2021-11-29)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/45.1...46.0</p> <ul> <li>Add Step-by-Step page type</li> <li>Add accordion block to long-form content pages</li> <li>Fix process_block_numbers to consider non-heading numbers</li> <li>Change search result label &amp; date colour to meet WCAG AA standard</li> <li>Change paragraph number to meet WCAG AA standard</li> </ul>"},{"location":"CHANGELOG/#451-2021-11-05","title":"45.1 (2021-11-05)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/45.0...45.1</p> <ul> <li>Fix accordion element IDs and aria roles mismatch</li> </ul>"},{"location":"CHANGELOG/#450-2021-10-12","title":"45.0 (2021-10-12)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/44.1...45.0</p> <ul> <li>No longer set CSRF cookies for FormPage forms and derivatives, or job search form</li> <li>Update job category and subcategory filtering documentation</li> <li>Use RoutablePageMixin and redirects to show Aptean Respond instruction, form, and success pages</li> </ul>"},{"location":"CHANGELOG/#441-2021-10-06","title":"44.1 (2021-10-06)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/44.0...44.1</p> <ul> <li>Upgrade Wagtail Transfer to 0.8.2</li> </ul>"},{"location":"CHANGELOG/#440-2021-10-04","title":"44.0 (2021-10-04)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/43.0...44.0</p> <ul> <li>333 Fix to accordion alignment</li> <li>Accessibility 321 Fix job search results validation issues</li> <li>Relabel heading blocks on longform pages, and add H4 block</li> </ul>"},{"location":"CHANGELOG/#431-2021-09-27","title":"43.1 (2021-09-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/43.0...43.1</p> <ul> <li>Make settings.DATA_UPLOAD_MAX_NUMBER_FIELDS configurable</li> </ul>"},{"location":"CHANGELOG/#430-2021-09-17","title":"43.0 (2021-09-17)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/42.0...43.0</p> <ul> <li>Accessibility 250 Fix HTML validation: element style not allowed as child of element main</li> <li>Accessibility 250 Fix job search input placeholder text contrast</li> <li>Remove unused call to action StreamField block template</li> <li>Use \"or\" search operator</li> <li>Use Longform Page chapter headings in the table of contents and pagination</li> </ul>"},{"location":"CHANGELOG/#420-2021-08-25","title":"42.0 (2021-08-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/41.0...42.0</p> <ul> <li>15: Add campaign page type</li> <li>Permit configuring some host names never to be indexed by external search engines</li> </ul>"},{"location":"CHANGELOG/#410-2021-08-19","title":"41.0 (2021-08-19)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/40.0...41.0</p> <ul> <li>Add \"DBS check\" field to TalentLink jobs and display the information in the sidebar</li> </ul>"},{"location":"CHANGELOG/#400-2021-07-19","title":"40.0 (2021-07-19)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/39.1...40.0</p> <ul> <li>Add chart StreamField blocks to long-form content pages</li> <li>Stop using CSRF tokens for feedback widget</li> </ul>"},{"location":"CHANGELOG/#391-2021-07-07","title":"39.1 (2021-07-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/39.0...39.1</p> <ul> <li>Upgrade Django to 2.2.24</li> </ul>"},{"location":"CHANGELOG/#390-2021-07-01","title":"39.0 (2021-07-01)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/38.0...39.0</p> <ul> <li>Add CI job to deploy the master branch to Content Prep server</li> <li>Enable content transfer between Wagtail instances using https://github.com/wagtail/wagtail-transfer</li> <li>Upgrade Wagtail to version 2.13.2</li> </ul>"},{"location":"CHANGELOG/#380-2021-06-28","title":"38.0 (2021-06-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/37.3...38.0</p> <ul> <li>Add feature flags to disable page feedback and job alert forms</li> <li>Add validation of duplicate responses to LookupPage admin</li> <li>Fix 128: Use inline index subtitle in table of contents and pagination</li> <li>Use PostgreSQL 13.3 in Vagrant box and CI</li> </ul>"},{"location":"CHANGELOG/#373-2021-06-11","title":"37.3 (2021-06-11)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/37.2...37.3</p> <ul> <li>Fix: Field label typo in page feedback form</li> </ul>"},{"location":"CHANGELOG/#372-2021-06-10","title":"37.2 (2021-06-10)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/37.1...37.2</p> <ul> <li>Fix: Handle URLs longer than 200 characters in page feedback form</li> </ul>"},{"location":"CHANGELOG/#371-2021-06-09","title":"37.1 (2021-06-09)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/37.0...37.1</p> <ul> <li>Fix (Accessibility): Duplicate HTML element IDs in feedback form</li> <li>Fix (Accessibility): Prevent duplicate h2 element IDs in alerts</li> <li>Fix: StreamField typo causing missing block types in editor in Wagtail 2.13</li> <li>Upgrade Wagtail to version 2.13.1</li> </ul>"},{"location":"CHANGELOG/#370-2021-06-07","title":"37.0 (2021-06-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/36.1...37.0</p> <ul> <li>40: Feedback forms and reports</li> <li>Accessibility improvements</li> <li>Add multiple severity levels to sitewide alert</li> <li>Fix: StreamField typo causing RecursionError in Wagtail 2.13</li> <li>Upgrade Wagtail to version 2.13</li> <li>Use the newly released django-gov-notify library for GOV.UK Notify integration</li> </ul>"},{"location":"CHANGELOG/#361-2021-05-25","title":"36.1 (2021-05-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/36.0...36.1</p> <ul> <li>Fix: Include attachments in FOI form data</li> </ul>"},{"location":"CHANGELOG/#360-2021-05-20","title":"36.0 (2021-05-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/35.2...36.0</p> <ul> <li>Add ENEI logo to Jobs site header</li> <li>Update CI config to use the cache to store artefacts</li> <li>Upgrade Django to 2.2.21</li> </ul>"},{"location":"CHANGELOG/#352-2021-04-21","title":"35.2 (2021-04-21)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/35.1...35.2</p> <ul> <li>Fix: XSS vulnerability in \"no search results\" page</li> </ul>"},{"location":"CHANGELOG/#351-2021-02-24","title":"35.1 (2021-02-24)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/35.0...35.1</p> <ul> <li>Upgrade Django to 2.2.19</li> </ul>"},{"location":"CHANGELOG/#350-2021-02-18","title":"35.0 (2021-02-18)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/34.1...35.0</p> <ul> <li>498: Reduce news boost in search results</li> <li>513: Allow second FIS homepage for Care Advice microsite</li> <li>517: Fix: Preview behind basic auth with new <code>baipw</code> version</li> <li>518: Include FIS pages in search results</li> <li>519: Fix: OGL below links and typo</li> <li>520: Fix: Add <code>search_input_help_text</code> setting to allow directory link for FIS</li> <li>521: Fix: Upgrade Wagtail 2.12.2 to prevent migration issue in CI</li> </ul>"},{"location":"CHANGELOG/#341-2021-02-15","title":"34.1 (2021-02-15)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/33.0...34.1</p> <ul> <li>Fix: Update GitHub Pages workflow to ensure publication of docs</li> </ul>"},{"location":"CHANGELOG/#340-2021-02-15","title":"34.0 (2021-02-15)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/33.0...34.0</p> <ul> <li>239: Prepare repository for open sourcing</li> <li>508: Upgrade Wagtail to version 2.12</li> <li>Fix: Check page exists before calling pageurl in footer</li> </ul>"},{"location":"CHANGELOG/#330-2021-02-02","title":"33.0 (2021-02-02)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/32.1...33.0</p> <ul> <li>466: [longform 9] Prepare base template for long-form content pages</li> <li>466: [longform 14] Add hero image to long-form content pages</li> <li>466: [longform 10] Add numbered headings for long-form content pages</li> <li>489: Allow information page under FIS home page.</li> <li>Upgrade <code>django-basic-auth-ip-whitelist</code> to avoid caching of 401 resonses.</li> </ul>"},{"location":"CHANGELOG/#321-2021-01-28","title":"32.1 (2021-01-28)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/32.0...32.1</p> <ul> <li>335: Fix so that component images aren't overwritten</li> </ul>"},{"location":"CHANGELOG/#320-2021-01-27","title":"32.0 (2021-01-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/31.0...32.0</p> <ul> <li>335: Responsive images for mobile</li> <li>366: Annotate search results with section or site name</li> <li>392: Use default sharing text if no sharing text set on page</li> <li>467: Enable automatic creation of redirects for moving pages and slug changes.</li> <li>483: Add date to news pages in search results</li> </ul>"},{"location":"CHANGELOG/#310-2021-01-19","title":"31.0 (2021-01-19)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/30.3...31.0</p> <ul> <li>381: Wagtail number list in the editor shouldn't be partially hidden for double digits+</li> <li>450: Prevent draft <code>InlineIndexChild</code> pages from being listed in index and navigation on live pages</li> <li>477: Upgrade Wagtail to 2.11</li> </ul>"},{"location":"CHANGELOG/#303-2021-01-14","title":"30.3 (2021-01-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/30.2...30.3</p> <ul> <li>490: Bump <code>notifications-python-client</code> to version 5.7.1 for <code>PyJWT</code> 2.0.0 compatibility (fix email send errors)</li> </ul>"},{"location":"CHANGELOG/#302-2021-01-13","title":"30.2 (2021-01-13)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/30.1...30.2</p> <ul> <li>464: Remove footer columns requirement in navigation settings</li> </ul>"},{"location":"CHANGELOG/#301-2020-12-14","title":"30.1 (2020-12-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/30.0...30.1</p> <ul> <li>478: Exclude FIS pages from search (temporary fix until FIS content is ready)</li> </ul>"},{"location":"CHANGELOG/#300-2020-12-14","title":"30.0 (2020-12-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/29.0...30.0</p> <ul> <li>402: Add anchor links for streamfield heading blocks</li> <li>472: Upgrade Wagtail to 2.10</li> <li>475: FIS Allow <code>IndexPage</code> as child page of <code>CategoryTypeOnePage</code> and <code>CategoryTypeTwoPage</code></li> <li>476: FISAllow <code>InformationPage</code> as child page of <code>CategoryTypeOnePage</code> and <code>CategoryTypeTwoPage</code></li> </ul>"},{"location":"CHANGELOG/#290-2020-11-30","title":"29.0 (2020-11-30)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/28.0...29.0</p> <ul> <li>Add support for Elasticsearch backend</li> <li>Add configurable search synonyms</li> <li>Use Porter stemming algorithm search filter, for English grammar</li> <li>Add an English stop words search filter</li> <li>Prevent password-protected pages from appearing in search results</li> <li>Add StreamField ImageBlock alt text field</li> </ul>"},{"location":"CHANGELOG/#280-2020-11-25","title":"28.0 (2020-11-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/27.0...28.0</p> <ul> <li>FIS Homepage: Style page and components</li> <li>FIS Category Type 1 / SEND Page: Style page and components</li> <li>FIS Category Type 2 / Regular Page: Style page and components</li> <li>FIS Inline Index Page: Hide sidebar</li> <li>FIS Footer: Style footer</li> <li>FIS Header: Style header</li> <li>Update margins between paragraphs in accordion blocks</li> <li>Add an editable body that will show when there's no results in the Search page</li> <li>Add schema.org Organization markup to home page</li> <li>Add new 'Am I in lockdown?' streamfields - FE styling</li> <li>Add new Highlight StreamField block</li> <li>Add LookupPage type to search for information about postcodes</li> <li>Accessibility 12 Fix HTML validation error for duplicated IDs when searching</li> <li>Fix edge-case failure with middleware is_recruitment_site check</li> <li>Fix form errors in pattern library</li> </ul>"},{"location":"CHANGELOG/#270-2020-10-15","title":"27.0 (2020-10-15)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/26.0...27.0</p> <ul> <li>Add Wagtail admin report of pages missing SEO metadata, and those with unpublished changes</li> <li>Accessibility 89 Form error handling - add explanatory text and supporting aria-labels for required fields</li> <li>Accessibility 91 Add in missing fieldsets for radio input groups</li> <li>Add schema.org markup to job detail page</li> </ul>"},{"location":"CHANGELOG/#260-2020-09-22","title":"26.0 (2020-09-22)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/25.0...26.0</p> <ul> <li>Add an 'OGL' logo, statement and link to the footer</li> <li>Accessibility 17 Add subpages to the Jobs sitemap</li> <li>Accessibility 76 Improve accordion markup &amp; styles (including job filters)</li> <li>Accessibility 93 Add meaningful link text for pagination</li> <li>Accessibility 94 Add aria-labels to social links</li> <li>Accessibility 87 Improve markup of feedback widget buttons and add aria-labels</li> <li>Silently ignore SQL injection attempts in job search</li> </ul>"},{"location":"CHANGELOG/#250-2020-09-14","title":"25.0 (2020-09-14)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/24.0...25.0</p> <ul> <li>Fix string spacing issue in Aptean forms help text</li> <li>Change complaints form contact fields</li> </ul>"},{"location":"CHANGELOG/#240-2020-08-20","title":"24.0 (2020-08-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/23.0...24.0</p> <ul> <li>Refactor Aptean Respond API integration to give more control over form presentation</li> <li>Add file field support to Aptean Respond forms</li> <li>Custom sizes for input fields</li> <li>Sitewide alert messages</li> <li>Always show application forms front end component, even if the job ID is not imported</li> </ul>"},{"location":"CHANGELOG/#230-2020-07-27","title":"23.0 (2020-07-27)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/22.0...23.0</p> <ul> <li>Accessibility 77 Further changes to prevent horizontal scrolling on smaller mobile devices</li> <li>Add social media text &amp; new icon/links to footer</li> <li>Fix for bottom of homepage displaying incorrectly on IE11</li> </ul>"},{"location":"CHANGELOG/#220-2020-07-23","title":"22.0 (2020-07-23)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/21.0...22.0</p> <ul> <li>Upgrade Wagtail to 2.9.3</li> <li>Configure Wagtail's Cloudflare front end cache invalidation</li> <li>Add to documentation about caching infrastructure</li> <li>Jobs: Add Restless logo to header</li> <li>Jobs 166 set up reuse application button</li> <li>Accessibility 47 Increase contrast of form help text</li> <li>Accessibility 80 Improve landmark aria labelling</li> <li>Accessibility 81 Content not included in landmarks</li> </ul>"},{"location":"CHANGELOG/#210-2020-07-09","title":"21.0 (2020-07-09)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/20.0...21.0</p> <ul> <li>Accessibility 79 Hide sidebar aria-labelledby attribute when there are no related pages</li> <li>Add page feedback widget</li> </ul>"},{"location":"CHANGELOG/#200-2020-07-02","title":"20.0 (2020-07-02)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/19.1...20.0</p> <ul> <li>Add cookie banner to recruitment / jobs site</li> <li>Make max-width larger on main wrapper</li> <li>Adjust line height of headings</li> <li>Progressive disclosure details (BE)</li> <li>Update newsletter signup URL</li> <li>Add favicon to recruitment site</li> <li>Reinstate display of promoted search results</li> <li>Fix 'no results found' message when there is no search query</li> <li>Enable embedding YouTube videos without using cookies and without showing   unrelated video links</li> <li>Make the homepage child sections 'menu' respect the 'show_in_menus' property</li> <li>Mobile-friendly tables</li> <li>Accessibility 77 Remove horizontal scrolling for smaller mobile devices</li> <li>Accessibility 78 Improve pagination link text (Silktide improvement)</li> <li>Improve the method for returning a formatted Aptean Respond case reference number</li> </ul>"},{"location":"CHANGELOG/#191-2020-06-23","title":"19.1 (2020-06-23)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/19.0...19.1</p> <ul> <li>Add cache prevention headers to Aptean Respond form pages</li> </ul>"},{"location":"CHANGELOG/#190-2020-06-11","title":"19.0 (2020-06-11)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/18.0...19.0</p> <ul> <li>Upgrade Wagtail to 2.9</li> <li>404 page</li> <li>Styling of label text on checkboxes and radio buttons</li> <li>Remove current page from breadcrumbs</li> <li>Adjust margins before / after buttons and other elements</li> <li>Fix search results font sizes / styling</li> <li>Fix incorrect heading levels for body text headings and subheadings</li> </ul>"},{"location":"CHANGELOG/#180-2020-06-04","title":"18.0 (2020-06-04)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/17.0...18.0</p> <ul> <li>Upgrade Django to 2.2.13</li> <li>Permit subdomain sites to have different base templates, depending on homepage type</li> <li>Sign up to council newsletter(s) from the homepage</li> <li>Update cookie notice</li> <li>Fix job alert emails</li> <li>Make the job application page return 404 status for bad IDs</li> <li>Update job search salary filter to use searchable salary instead of salary range</li> <li>Add documentation about CI deployments</li> <li>Update documentation about personally-identifying data</li> <li>Add documentation about the procedure for resetting the staging branch/server/db</li> </ul>"},{"location":"CHANGELOG/#170-2020-05-21","title":"17.0 (2020-05-21)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/16.1...17.0</p> <ul> <li>Change GitLab HTML syntax highlighter</li> <li>Accessibility 37 Improve aria role of alert panel</li> <li>Accessibility 53 Hide footer links landmark if there are none</li> <li>Accessibility 55 Email alert subscription form improvements</li> <li>Accessibility 56 Remove extra role=\"search\" form from header on search page</li> <li>Accessibility 57 Label complementary landmarks</li> <li>Accessibility 61 Remove alt text for decorative images</li> </ul>"},{"location":"CHANGELOG/#161-2020-05-20","title":"16.1 (2020-05-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/16.0...16.1</p> <ul> <li>Enable a job board-dependent template variable for the application page. This   fixes internal job applications.</li> <li>Fix an error when job application URL query is badly formatted</li> </ul>"},{"location":"CHANGELOG/#160-2020-05-07","title":"16.0 (2020-05-07)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/15.1...16.0</p> <ul> <li>Fix for employer logo sizes (FE)</li> <li>Add active checkbox counter &amp; reset filters button for job search (FE)</li> <li>Progressive accordion styling update (including postcode search fix)</li> <li>Accessibility 14 Increase contrast of Highlighted Content heading</li> <li>Accessibility 16 Fix Jobs filter fieldset legends</li> <li>Accessibility 18 Page content should be in a landmark</li> <li>Accessibility 19 Remove nesting for landmarks</li> <li>Accessibility 44 &amp; 75 Pagination improvements</li> <li>Accessibility 58 Add screen-reader-only text to filters\u2019 item count</li> <li>Accessibility 60 Fix typo in location field placeholder</li> <li>Accessibility 62 Hide \"Find out more\" for screen reader users (Jobs benefits)</li> </ul>"},{"location":"CHANGELOG/#151-2020-05-01","title":"15.1 (2020-05-01)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/15.0...15.1</p> <ul> <li>Fix for breadcrumbs</li> </ul>"},{"location":"CHANGELOG/#150-2020-05-01","title":"15.0 (2020-05-01)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/14.0...15.0</p> <ul> <li>Add tests for job categories import fix</li> <li>Add unit tests for Aptean Respond integration</li> <li>Subheading block (BE)</li> <li>Styling fix for links to local areas</li> <li>Fix spacing in breadcrumb navigation</li> <li>Fix spacing on job detail template</li> <li>Fix for multiple form submissions</li> <li>142 Internal jobs site</li> <li>Alert panel and Aptean Form Page confirmation page template update</li> <li>Reformat Aptean Respond submitted case reference numbers for display to users</li> <li>Accessibility 1 Remove redundant/inappropriate ARIA role overrides</li> <li>Accessibility 8 Hide all site icons for screen reader users</li> <li>Accessibility 9 Improvements to screen reader only navigational content</li> <li>Accessibility 11 Fix HTML validation errors on the main site</li> <li>Accessibility 13 Fix jobs search filters HTML validation errors on IDs</li> <li>Accessibility 9 &amp; 13 Breadcrumb improvements</li> <li>Accessibility 22 Switch unnecessary heading tag to link in Jobs header</li> <li>Accessibility 23 Increase contrast of jobs filter help text</li> <li>Accessibility 28 Update language attribute on all templates</li> <li>Accessibility 36 Update homepage table of contents &amp; add aria-labelledby</li> </ul>"},{"location":"CHANGELOG/#140-2020-04-22","title":"14.0 (2020-04-22)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/13.0...14.0</p> <ul> <li>135 Employer logos (BE)</li> <li>176 Jobs fix import location</li> <li>204 Jobs fix salary imports (BE)</li> </ul>"},{"location":"CHANGELOG/#130-2020-04-20","title":"13.0 (2020-04-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/12.0...13.0</p> <ul> <li>Upgrade Wagtail to 2.7.2 and Django to 2.2.12</li> <li>Add documentation about Aptean Respond cases backend, and cookies</li> <li>Make the separate forms on the jobs search page cooperate</li> <li>Styling tweaks on recruitment index page ('benefits' page)</li> <li>Add favicon</li> <li>140 Job site breadcrumbs on all pages</li> <li>155 Jobs extra filters (BE)</li> <li>161 Update job search filter styles and add custom select form field</li> <li>173 Search local council area by postcode</li> <li>179 Jobs additional fields BE</li> </ul>"},{"location":"CHANGELOG/#120-2020-04-02","title":"12.0 (2020-04-02)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/11.0...12.0</p> <ul> <li>136 Employer logos (FE)</li> <li>172 Add live chat support feature</li> <li>174 Fix button padding</li> <li>175 Remove hard coded Bucks logo from job detail pages</li> <li>193 Fix issue with duplicate JobSubcategory titles</li> </ul>"},{"location":"CHANGELOG/#110-2020-04-01","title":"11.0 (2020-04-01)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/10.0...11.0</p> <ul> <li>Improve page 'Promote' tab SEO field labels</li> <li>100 Job categories (FE)</li> <li>158 Job application form styling</li> </ul>"},{"location":"CHANGELOG/#100-2020-03-31","title":"10.0 (2020-03-31)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/9.0...10.0</p> <ul> <li>114 StreamField Button Link block (BE)</li> <li>125 Job attachments</li> <li>138 Additional job sidebar fields (FE)</li> <li>139 Additional job sidebar fields (BE)</li> <li>148 Delete outdated jobs when running import command</li> </ul>"},{"location":"CHANGELOG/#90-2020-03-31","title":"9.0 (2020-03-31)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/8.0...9.0</p> <ul> <li>129 Jobs postcode search</li> <li>169 Adjust position of form field help text</li> <li>Forms integration with Aptean Respond API</li> <li>Fix an issue with CI deployments</li> </ul>"},{"location":"CHANGELOG/#80-2020-03-30","title":"8.0 (2020-03-30)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/7.0...8.0</p> <ul> <li>Update documentation to reflect change in git workflow.</li> <li>108 Search alert (FE)</li> <li>112 Unsubscribe from alerts (FE)</li> <li>115 StreamField Button Link block</li> <li>117 StreamField Table styles</li> <li>121 Progressive disclosure accordion</li> <li>122 General formatting improvements</li> <li>123 Subheading block</li> <li>163 Add Fathom Analytics</li> <li>201 additional components</li> </ul>"},{"location":"CHANGELOG/#70-2020-03-25","title":"7.0 (2020-03-25)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/6.0...7.0</p> <ul> <li>51 Events Page front end</li> <li>68 News Page front end</li> <li>105 Job applications back-end</li> <li>106 Job applications front-end</li> <li>109 Job alert subscription</li> <li>110 Job search alert notifications</li> <li>111 Job alert unsubscribe</li> <li>130 Add a Schools and Early years search filter, and enable Job Category to be tagged as such.</li> <li>133 Search by job number</li> </ul>"},{"location":"CHANGELOG/#60-2020-03-24","title":"6.0 (2020-03-24)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/5.0...6.0</p> <ul> <li>Added image and embed blocks to StoryBlock</li> </ul>"},{"location":"CHANGELOG/#50-2020-03-20","title":"5.0 (2020-03-20)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/4.0...5.0</p> <ul> <li>Enable FormPages</li> <li>Add Yandex and Bing verification strings</li> </ul>"},{"location":"CHANGELOG/#40-2020-02-24","title":"4.0 (2020-02-24)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/3.2...4.0</p> <ul> <li>Update deployment documentation</li> <li>59 Jobs homepage</li> <li>62 Jobs detail page</li> <li>85 TalentLink API client, and importer commands</li> <li>90 Jobs Category and homepage categories listing</li> <li>92 Recruitment index page</li> <li>94 Jobs import HTML formatting improvements</li> <li>96 Jobs search: add category filter</li> <li>99 Add slugs to job category</li> <li>104 Add job subcategory</li> </ul>"},{"location":"CHANGELOG/#32-2020-02-17","title":"3.2 (2020-02-17)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/3.1...3.2</p> <ul> <li>116 Enable StreamField Table Block</li> <li>118 Add border to search inputs</li> </ul>"},{"location":"CHANGELOG/#31-2020-02-10","title":"3.1 (2020-02-10)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/3.0...3.1</p> <ul> <li>82 Adjust header logo size</li> </ul>"},{"location":"CHANGELOG/#30-2020-02-10","title":"3.0 (2020-02-10)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/2.1...3.0</p> <ul> <li>Django 2.2.10</li> <li>Hotfix: Pin Redis version in requirements.txt</li> <li>Update CI pipeline stage names and order to make progress clearer</li> <li>83 Specify border radius on inputs</li> <li>87 Remove flag from external links</li> <li>88 Updated IndexPage to allow it to be created under IndexPage</li> <li>Fix: Update \"Home\" breadcrumb link target to work with multiple sites</li> </ul>"},{"location":"CHANGELOG/#21-2020-01-22","title":"2.1 (2020-01-22)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/2.0...2.1</p> <p>Temporary changes for launch</p> <ul> <li>Remove email signup form</li> <li>Remove cookie banner</li> </ul>"},{"location":"CHANGELOG/#20-2020-01-21","title":"2.0 (2020-01-21)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/1.1...2.0</p> <ul> <li>26 Add GOV.UK Notify email backend</li> <li>79 Redirect-to field on all pages</li> <li>66 Update Call to Action snippet to support multiple links</li> <li>47 Search results to display local area links where applicable</li> <li>67 Enabled News and Events apps. Add latest news and events to homepage.</li> <li>76 Homepage temporary banner</li> <li>86 Amend Local Area Links postscript default text</li> <li>84 Site wide alpha banner</li> <li>43, 71 Inline Index page</li> </ul>"},{"location":"CHANGELOG/#11-2019-12-19","title":"1.1 (2019-12-19)","text":"<p>Compare: https://git.torchbox.com/buckinghamshire-council/bc/compare/1.0...1.1</p> <ul> <li>Django 2.2.9 security release</li> </ul>"},{"location":"CHANGELOG/#10-2019-12-18","title":"1.0 (2019-12-18)","text":"<p>https://git.torchbox.com/buckinghamshire-council/bc/-/tags/1.0</p> <ul> <li>7, 27 IndexPage</li> <li>Added child_pages, featured_pages and ordinary_pages properties</li> <li>Updated page context and template to remove paginator and to use above properties</li> <li>Added unit tests</li> <li>Added automatic secret detection to pre-commit hooks</li> <li>9 Homepage hero and homepage unit tests</li> <li>10 Information page</li> <li>Make H2 available as a block only, not in RichTextBlocks</li> <li>Limit rich text features</li> <li>Local Area Links block</li> <li>21 disable events, news, people, and forms apps as we are not using them yet.</li> </ul>"},{"location":"anonymised-data/","title":"Buckinghamshire Council Anonymising Data","text":""},{"location":"anonymised-data/#general-principles","title":"General principles:","text":"<ul> <li>pull data from staging rather than production servers, if this is good enough for your needs</li> <li>if it is necessary to pull data from production, e.g. for troubleshooting, consider whether anonymising personal data is possible and compatible with your needs</li> <li>if it is necessary to pull non-anonymised data from production, consider destroying this copy of the data as soon as you no longer need it</li> </ul> <p>In more sensitive cases, consider a data protection policy to prevent access to production data except for authorised users.</p>"},{"location":"anonymised-data/#anonymise","title":"Anonymise","text":"<p><code>django-birdbath</code> provides a management command (<code>run_birdbath</code>) that will anonymise the database.</p> <p>As and when models/fields are added that may be populated with sensitive data (such as email addresses) a processor should be added to ensure that the data can be anonymised or deleted when it is copied from the production environment.</p> <p>For full documentation see https://git.torchbox.com/internal/django-birdbath/-/blob/master/README.md.</p>"},{"location":"anonymised-data/#data-processors","title":"Data processors","text":"<p>The data processors can be found in base.py</p> <pre><code>BIRDBATH_PROCESSORS = [\n    \"birdbath.processors.users.UserEmailAnonymiser\",\n    \"birdbath.processors.users.UserPasswordAnonymiser\",\n    \"birdbath.processors.contrib.wagtail.FormSubmissionCleaner\",\n    \"birdbath.processors.contrib.wagtail.SearchQueryCleaner\",\n    \"bc.blogs.birdbath.DeleteAllBlogAlertSubscriptionProcessor\",\n    \"bc.recruitment.birdbath.DeleteAllRecruitmentAlertSubscriptionProcessor\",\n]\n</code></pre> <p>The <code>flightpath</code> tool can be used to copy production data (and media) from the production environment to staging. It will automatically <code>run_birdbath</code> immediately following this sync operation. A manual CI action is included that will trigger flightpath to sync the environments.</p> <p>Intended workflow:</p> <ol> <li>production data is synced to staging by flightpath    - birdbath anonymises staging database</li> <li>anonymised data is pulled from staging to development environments</li> </ol> <p>This workfow should mean that un-anonymised data is never present on a developer's machine. If data directly from production is required, then <code>run_birdbath</code> command should be run immediately after download.</p>"},{"location":"complaints-and-requests/","title":"Complaints and Request Forms","text":"<p>This document covers those forms which integrate with the Aptean Respond case management platform.</p> <p>Some other forms within the project are implemented using Wagtail's Forms contrib module, and are not covered here.</p>"},{"location":"complaints-and-requests/#background","title":"Background","text":"<p>The company Aptean produces a platform called Respond, which tracks customer enquiry 'cases'. It is a REST API using XML. Documentation is only available in PDFs, which are generally available from the client as email attachments.</p> <p>Note that the documentation is terse, has differing variable naming standards (<code>schema-name</code> vs <code>schemaName</code>), differing parameters between example request payloads (some specify a per-field <code>data-type</code> attribute, some not), syntax errors in the example XML schemata (in addition to any errors got by copying and pasting from the PDF document, which adds headers and footers and mangles line breaks), and example XML request payloads that do not validate against those schemata.</p> <p>The web services available in the API are configured by council staff in a desktop program called \"Configuration Manager\". We use the following endpoints:</p> <ul> <li>Web Service Meta Data Service, to list the web services configured in configuration manager</li> <li>Create Case Service, to POST a user's form submission</li> <li>Get Fields Service, to get the properties of a field (mainly 'required')</li> <li>Get Categories Service, to get the valid choices for a 'category' field (i.e. any represented by a select input)</li> </ul> <p>We have asked the client to configure the Get Fields Service and Get Categories Service to contain data for all fields, which we cache in our application client and use to build the form information.</p> <p>Note that the Get Fields Service does not allow the council staff to specify the order of fields in a case. That is defined in our application. The fields they can add are only those defined by Aptean. Custom fields at the API level are, generally, not possible.</p> <p>Any custom properties, such as the labels, help_text, removing of <code>choices</code> options, and overriding of <code>required</code> properties is done in Python code. In several cases we add custom fields to the form which are processed and appended to the description before submission.</p> <p>The form UX in the designs is much more complicated than this allows, so further features are added in our application.</p>"},{"location":"complaints-and-requests/#credentials","title":"Credentials","text":"<p>The following environment variables must be set to authenticate with the API (or configured in local settings, for dev enviromnents):</p> <ul> <li><code>RESPOND_API_USERNAME</code></li> <li><code>RESPOND_API_PASSWORD</code></li> <li><code>RESPOND_API_DATABASE</code> \u2014 \"Prod\" or \"Test\"</li> <li><code>RESPOND_API_BASE_URL</code> \u2014 set this to \"https://groupc.respond.apteancloud.com/Buckinghamshire/ws/\"</li> </ul> <p>We also define the names of the CreateCase-type services that we wish to 'register'.</p> <ul> <li><code>RESPOND_COMPLAINTS_WEBSERVICE</code> e.g. \"TestCreateComplaints\"</li> <li><code>RESPOND_FOI_WEBSERVICE</code></li> <li><code>RESPOND_SAR_WEBSERVICE</code></li> <li><code>RESPOND_COMMENTS_WEBSERVICE</code></li> <li><code>RESPOND_COMPLIMENTS_WEBSERVICE</code></li> <li><code>RESPOND_DISCLOSURES_WEBSERVICE</code></li> </ul>"},{"location":"complaints-and-requests/#api-client","title":"API Client","text":"<p>The API client is loaded when first needed by <code>bc.cases.backends.respond.client.get_client()</code> and remains in memory.</p> <p>There is a page type <code>bc.cases.models.ApteanRespondFormPage</code>, which has a field <code>form</code>. This determines what form should load for the page.</p> <p>The form classes all inherit from <code>bc.cases.backends.respond.forms.BaseCaseForm</code>, which handles producing XML for the API.</p>"},{"location":"complaints-and-requests/#xml","title":"XML","text":"<p>Typically within the application, API XML responses are parsed with Beautiful Soup, but XML request payloads are assembled with <code>lxml.etree</code>. These have different internal APIs, so watch out for that.</p> <p>The <code>bc.cases.backends.respond.forms.BaseCaseForm</code> class has a method <code>self.get_xml(cleaned_data)</code> to return the payload for an API request.</p>"},{"location":"complaints-and-requests/#append-to-description-fields","title":"Append-to-description fields","text":"<p>All form fields to be submitted to the API must either be mapped in the form's <code>.field_schema_name_mapping</code> attribute. If no suitable schema name exists in the API web service definition, the field name must be included in the form's <code>.append_to_description_fields</code> property. The label and cleaned value of these fields will be appended to the description field before form submission.</p>"},{"location":"continuous-deployment/","title":"Continuous Deployment","text":"<p>Deployments can be triggered through GitLab's CI/CD. Currently <code>.gitlab-ci.yml</code> has a <code>deploy_site</code> stage which is configured to deploy to Heroku on pushes and merge requests to either master or staging.</p> <p>Deployments can also be done through the terminal with Git and the heroku CLI, however best practice is to go through the GitLab CI/CD.</p> <p>For information on hosting such as Heroku app names see hosting documentation.</p>"},{"location":"continuous-deployment/#deploying-to-production","title":"Deploying to production","text":"<p>After the <code>Deploy to production</code> stage of the development life cycle wait for the pipeline to pass, click on the <code>Manual job</code> dropdown and then click <code>deploy_production</code>. This will require <code>maintainer</code> permission for the project on GitLab.</p> <p>There is an additional manual task <code>deploy_content_prep</code>. This should generally be run whenever a production deployment is preformed, as it keeps the codebase and database on the Content Prep server in sync with production.</p>"},{"location":"continuous-deployment/#deploying-to-staging","title":"Deploying to staging","text":"<p>Unlike production, deployments to staging are done automatically through GitLab CI/CD, simply push to staging.</p>"},{"location":"continuous-integration/","title":"Continuous Integration","text":"<p>Gitlab has built-in CI tests. These can be configured by editing <code>.gitlab-ci.yml</code>. By default, these are run on all pushes and merge requests.</p> <p>Currently, GitLab is configured to run all Python and JavaScript tests, as well as enforcing the styleguide.</p>"},{"location":"continuous-integration/#automatic-linting-locally","title":"Automatic linting locally","text":"<p>You can also run the linting tests automatically before committing. This is optional. It uses <code>pre-commit</code>, which is installed by default in the docker container, and a <code>.pre-commit-config.yml</code> file is included for the project.</p> <p>To use <code>pre-commit</code> when making commits on your host machine you must install <code>pre-commit</code>. Either create a virtualenv to use with the project or to install globally. Please refer to the <code>pre-commit</code> install instructions for more information.</p> <p><code>pre-commit</code> will not run by default. To set it up, run <code>pre-commit install</code> inside the Docker container, or on the host if you have installed <code>pre-commit</code> there.</p> <p>If you are using <code>pre-commit</code> locally (outside of the Docker container) you will need to install <code>seed-isort-config</code> with <code>pip install seed-isort-config</code>.</p> <p>The <code>detect-secrets</code> hook requires a baseline secrets file to be included. If you need to, you can update this file, e.g. when adding dummy secrets for unit tests:</p> <pre><code>$ detect-secrets scan &gt; .secrets.baseline\n</code></pre>"},{"location":"contributing/","title":"Contributing","text":"<p>Before contributing to the open source project on GitHub, please consider that this project is opeen source but not collaborative. The features it includes are specifically designed to the needs of Buckinghamshire Council.</p> <p>Feature submissions are unlikely to be included in the project, unless the feature is specifically desired by the council. Bugfixes will be reviewed and included accoring to the process described below. Please be sure to follow the guidelines below on how to contribute to this open source project.</p>"},{"location":"contributing/#repository-setup","title":"Repository Setup","text":"<p>Internal development happens on an internal GitLab instance. A merge or push to the protetected <code>master</code> branch triggers a push to the open source GitHub repository.</p> <p>No active development happens on GitHub itself.</p> <p>The current setup was chosen to allow for open sourcing the repository without the need to migrate the whole CI setup from GitLab to GitHub. This setup may be changed in the future to remove the need of managing two repositories.</p>"},{"location":"contributing/#how-to-contribute-to-the-open-source-project","title":"How to Contribute to the Open Source Project","text":"<p>If you would like to contribute a bugfix to this project, just follow the normal flow for contributions on GitHub.</p> <ol> <li>Fork this repository on GitHub to create your own copy of it.</li> <li> <p>Clone your fork of the repository to your local development machine.</p> <pre><code>git clone [URL TO GIT REMOTE]\n</code></pre> </li> <li> <p>Create a new branch for the bugfix.</p> <pre><code>git checkout -b fix/something-broken\n</code></pre> </li> <li> <p>Create a local setup and implement your changes.</p> <pre><code>git commit fixed_file.py\n</code></pre> </li> <li> <p>Push your local fix branch to your GitHub fork.</p> <pre><code>git push origin fix/something-broken\n</code></pre> </li> <li> <p>View you fork of the repository on GitHub and create a Pull Request back to the <code>master</code> branch of the main repository.     Please include a description of the bug your PR is fixing and why you solved it the way you did.</p> </li> </ol>"},{"location":"contributing/#how-to-handle-contributions","title":"How to Handle Contributions","text":"<p>This section is for maintainers and reviewers of the internal project.</p> <p>Since CI has not been migrated to GitHub yet, automatic formatting, linting and test are not available at that point. The CI will run once the changes on GitHub are integrated to GitLab.</p> <ol> <li>Review the GitHub Pull Request accoring to the project standards.</li> <li>Be sure to check for undesired side-effects of the bugfix.</li> <li>If you're happy with the PR, merge it into <code>master</code> on GitHub.</li> </ol> <p><code>master</code> on GitHub will be overriden by the next push from GitLab. To avoid losing the just merged changes you need to integrate them into the GitLab repo.</p> <ol> <li> <p>Add the GitHub repo to your local development setup.</p> <pre><code>git remote add github [Github Repo URL]\n</code></pre> </li> <li> <p>Create a new branch from <code>release</code> on GitLab.</p> <pre><code>git checkout release\ngit pull origin release\ngit checkout -b fix/fix-from-github\n</code></pre> </li> <li> <p>Pull fix from <code>master</code> on GitHub into the new branch</p> <pre><code>git pull github master\n</code></pre> </li> <li> <p>Push the new branch to GitLab.</p> <pre><code>git push origin fix/fix-from-github\n</code></pre> </li> <li> <p>Check the CI pipeline to see if any formatting/linting/tests need to be fixed.     If so, do this in your local branch and push the changes again.</p> </li> <li> <p>Create a Merge Request on GitLab for the new branch to the <code>release</code> branch.     Proceed with the normal review process to make sure we want to include these changes into the project.</p> </li> </ol>"},{"location":"cookies/","title":"Cookies","text":"<p>See also: Data Protection</p> <p>The website team values minimising cookies, and data protection. Examples include:</p> <ul> <li>a clear listing of all cookies at https://www.buckinghamshire.gov.uk/about/cookies/</li> </ul>"},{"location":"cookies/#integrating-with-other-services","title":"Integrating with other services","text":"<p>If you add a feature which must set a cookie, speak to the client about whether it is necessary, and include updating the cookie policy page as part of the work.</p>"},{"location":"data-protection/","title":"Data Protection","text":"<p>See also: Cookies</p> <p>This page gives an overview of personally-identifying information (PII) stored or processed by the Buckinghamshire Council project.</p>"},{"location":"data-protection/#user-accounts","title":"User accounts","text":"<p>Buckinghamshire Council Wagtail user accounts store a user's name and email address.</p>"},{"location":"data-protection/#other","title":"Other","text":""},{"location":"data-protection/#wagtail-forms-submissions","title":"Wagtail Forms submissions","text":"<p>These can store any type of data, as they are configured by the editors at Buckinghamshire Council.</p> <p>Responsibility for the definition and use of form fields, and their compliance with the GDPR, rests with the Data Controller, Buckinghamshire Council.</p> <p>When duplicating the database for development purposes, developers are responsible for deleting these records from duplicates. See Data locations below.</p>"},{"location":"data-protection/#aptean-forms-submissions","title":"Aptean forms submissions","text":"<p>These submissions, part of the <code>bc.cases</code> app, are processed by Django view functions, but data is not stored in our application. Form submissions are posted via HTTPS to the Aptean Forms API. We also process responses to those submissions, which may contain PII if the response is an error message. Form field error messages are merely displayed to the user where possible, but may be stored in Sentry if a server error is caused. See Data locations &gt; Error logs below.</p>"},{"location":"data-protection/#other-personal-data-handling","title":"Other personal data handling","text":"<p>These are common sources of personal data which are not handled by the Buckinghamshire Council Django application.</p>"},{"location":"data-protection/#newsletter-subscription-requests","title":"Newsletter subscription requests","text":"<p>These requests are handled by sending the users to a third party, where PII is handled. The Django application does not handle any such data directly or indirectly.</p>"},{"location":"data-protection/#job-applications","title":"Job applications","text":"<p>These requests are handled by a third-party provider. The code which processes data is JavaScript hosted on our site, but provided by the third-party, and posting to an external API. Our servers do not process or store any personally-identifying data.</p>"},{"location":"data-protection/#data-locations","title":"Data locations","text":"<p>PII is stored in the database, in the models:</p> <ul> <li><code>bc.recruitment.models.JobAlertSubscription</code></li> <li><code>bc.users.models.User</code></li> <li><code>bc.forms.models.FormSubmission</code> (Wagtail FormPage instances)</li> </ul> <p>Potentially users submit feedback form responses which store personally identifying information in the model <code>bc.feedback.models.FeedbackComment</code>, though this is not invited.</p> <p>All backups, automated or otherwise, include this data.</p>"},{"location":"data-protection/#exports","title":"Exports","text":"<p>All exports include the above data. The first steps when downloading a copy of the production database, or cloning it to staging, should be to delete all records in the user-submitted tables:</p> <pre><code>$ python manage.py shell_plus\n&gt;&gt;&gt; JobAlertSubscription.objects.all().delete()\n&gt;&gt;&gt; FormSubmission.objects.all().delete()\n&gt;&gt;&gt; FeedbackComment.objects.all().delete()\n</code></pre> <p>When copying the data to staging, you probably want to leave user accounts intact, as users are not members of the public and will still want to access the staging site. If using the data locally, you should anonymise user accounts:</p> <pre><code>$ python manage.py shell_plus\n&gt;&gt;&gt; for user in User.objects.all():\n...     user.first_name = \"User\"\n...     user.last_name = user.id\n...     user.email = f\"user.{user.id}@example.com\"\n...     user.username = f\"user.{user.id}\"\n...     user.save()\n</code></pre>"},{"location":"data-protection/#error-logs","title":"Error logs","text":"<p>Personally-identifying data may also appear in error reports, at sentry.io. We have configured the Sentry project to anonymise known sensitive fields, including some bespoke fields for this project, such as for Aptean forms submissions.</p>"},{"location":"data-protection/#responding-to-gdpr-requests","title":"Responding to GDPR requests","text":"<p>If a request is received to purge or report the stored data for a given user, what steps are needed?</p> <ul> <li>For user account data, delete the user from the Wagtail admin https://www.buckinghamshire.gov.uk/admin/users/</li> <li>For form submissions, ask the client to handle requests as a first option. Failing that, search the submissions and delete if necessary using the Django shell.</li> <li>For JobAlertsSubscriptions, find and delete from https://www.buckinghamshire.gov.uk/admin/recruitment/jobalertsubscription/</li> <li>For page feedback data, find either from the report in the Wagtail admin or via the Django shell, then delete using the Django shell.</li> </ul> <p>Note: this will not purge such data from backups.</p>"},{"location":"email-and-sms/","title":"GOV.UK Notify email and SMS service","text":"<p>We use the GOV.UK Notify service for sending emails and SMS messages. Python Client Documentation.</p> <p>This is implemented as a custom Django email backend, now split out to the separate open-sourced Django extension <code>django-gov-notify</code>. It presents a similar internal API to standard Django email backends, but with some restrictions:</p> <ul> <li>GOV.UK Notify emails are sent to one recipient each. CC: and BCC: fields are not supported.</li> <li>A single email 'message' with multiple recipients will result in multiple individual API calls to GOV.UK Notify, each message being sent to a single recipient. The backend will still report back <code>1</code>, as per Django's default behaviour.</li> <li>Attachments are not (at the moment) supported.</li> <li>Custom headers are not supported.</li> <li>To configure a 'reply-to' address, you must first configure such an address in the admin</li> <li>The 'from' address field is not supported. Initial test emails came from buckinghamshire.council.website@notifications.service.gov.uk.</li> <li>Preformatted emails are expected to be configured in the service admin dashboard as Markdown templates with placeholders.</li> <li>The email body is interpreted as very limited Markdown. On testing, it seems that variables are not interpreted as markdown, or maybe mangled, e.g. <code>_test_</code> was emailed as <code>*test*</code>.</li> </ul>"},{"location":"email-and-sms/#configuration","title":"Configuration","text":"<p>Set the environment variables</p> <ul> <li><code>GOVUK_NOTIFY_API_KEY</code> (NB not GOV_UK\u2026)</li> <li><code>GOVUK_NOTIFY_PLAIN_EMAIL_TEMPLATE_ID</code></li> </ul>"},{"location":"email-and-sms/#usage","title":"Usage","text":""},{"location":"email-and-sms/#sending-an-email-using-a-template","title":"Sending an email using a template","text":"<p>Configure the template in the GOV.UK Notify dashboard:</p> <p>Subject: Message about ((topic)) Body: Hello ((first name)), your reference is ((ref number))</p> <p>Create an email message, supplying the template ID and a <code>personalisation</code> dictionary (this should also include variables in the subject as necessary):</p> <pre><code>from django_gov_notify.message import NotifyEmailMessage\n\nmessage = NotifyEmailMessage(\n    to=[\"recipient@example.com\"],\n    template_id=\"43573f75-80e7-402f-b308-e5f1066fbd6f\",\n    personalisation={\n        \"topic\": \"The Prisoner\",\n        \"first name\": \"Patrick\",\n        \"ref number\": \"6\",\n    },\n)\nmessage.send()\n</code></pre> <p>Note that in this case a subject and body are not required, nor permitted.</p>"},{"location":"email-and-sms/#sending-an-email-using-the-default-blank-template","title":"Sending an email using the default (blank) template","text":"<p>This assumes you have configured a blank template with the parameters</p> <p>Subject: ((subject)) Body: ((body))</p> <pre><code>from django_gov_notify.message import NotifyEmailMessage\n\nmessage = NotifyEmailMessage(\n    subject=\"Test subject\", body=\"Test message content\", to=[\"recipient@example.com\"]\n)\nmessage.send()\n</code></pre> <p>Note that in this case a subject and body are required, and you must not pass the <code>template_id</code> or <code>personalisation</code> kwargs.</p>"},{"location":"email-and-sms/#sending-an-email-using-the-send_mail-shortcut-function","title":"Sending an email using the <code>send_mail</code> shortcut function","text":"<p>Use it in the normal fashion, including a 'from' address that will be discarded:</p> <pre><code>from django.utils.mail import send_mail\n\nsend_mail(\"Subject\", \"Message content\", \"from@example.com\", [\"recipient@example.com\"])\n</code></pre> <p>This will use the blank template ID configured as <code>settings.GOVUK_NOTIFY_PLAIN_EMAIL_TEMPLATE_ID</code>. Attachments, custom headers, and BCC recipients are not supported.</p>"},{"location":"front-end-tooling/","title":"Front End Tooling","text":"<p>This set of tooling should form the basis for any new wagtail projects. It can also be used for custom django builds - simply copy the <code>static_src</code> directory from here to your build.</p>"},{"location":"front-end-tooling/#whats-required","title":"What's required","text":"<p>You can run the tooling within the VM where Node.js is pre-installed, but if you are using Mac OS, you will likely have issues with performance of <code>npm install</code> and other <code>npm</code> commands. It is adviced to Mac OS users to have node on the host machine. To install node on the host machine we recommend using <code>nvm</code>. Once you have <code>nvm</code> installed simply run <code>nvm install</code> to install and activate the version of node required for the project. Refer to the <code>nvm</code> documentation for more details about available commands.</p>"},{"location":"front-end-tooling/#setting-up-a-new-project-from-the-wagtail-kit-tooling","title":"Setting up a new project from the wagtail-kit tooling","text":"<p>The wagtail-kit tooling is versioned via <code>package.json</code>, and the <code>package-lock.json</code> lockfile pins all of the project\u2019s direct and transitive dependencies. If you wish to start the project with up to date dependencies without doing manual upgrades, you can discard the lockfile and re-create it:</p> <pre><code>rm -rf node_modules\nrm package-lock.json\nnpm install\n</code></pre> <p>Remember to then commit the updated <code>package-lock.json</code>.</p>"},{"location":"front-end-tooling/#whats-included","title":"What's included","text":"<ul> <li>Sass CSS with auto-prefixing.</li> <li>Babel for ES2015+ support.</li> <li>Browsersync for autoreloading.</li> <li>Webpack for module bundling.</li> <li>With <code>babel-loader</code> to process JavaScript.</li> <li>With <code>css-loader</code>, <code>postcss-loader</code>, and <code>sass-loader</code> to process stylesheets.</li> <li>Consideration for images, currently copying the directory only - to avoid slowdowns and non-essential dependancies. We encourage using SVG for UI vectors and pre-optimised UI photograph assets.</li> <li>Build commands for generating testable or deployable assets only</li> <li>CSS linting with <code>stylelint</code></li> <li>JS linting with <code>eslint</code></li> <li>Jest for JavaScript unit tests.</li> <li>React support</li> </ul>"},{"location":"front-end-tooling/#using-and-updating-the-tooling-when-making-changes-wagtail-kit","title":"Using and updating the tooling when making changes wagtail-kit","text":"<p>Updating and running the tooling in wagtail-kit is a bit fiddly, as if you create a <code>node_modules</code> folder in <code>/wagtail-kit/bc</code> the watcher script will throw an error.</p>"},{"location":"front-end-tooling/#running-the-tooling-whilst-making-changes","title":"Running the tooling whilst making changes","text":"<p>To run the tooling inside the <code>wagtail-kit</code> build, ensure that you run <code>npm install</code> from inside the built image, i.e. <code>wagtail-kit/built_image/ck_repo_name</code></p>"},{"location":"front-end-tooling/#making-changes-to-the-tooling","title":"Making changes to the tooling","text":"<p>The easiest way to install new packages is to run <code>npm install --save-dev package_name</code> in <code>wagtail-kit/built_image/ck_repo_name</code>, but then copy the resultant changes to <code>package.json</code> and <code>package-lock.json</code> over to <code>/wagtail-kit/bc</code> in order to save and commit them. Note that when you do this you need to edit the copied files and change all instances of <code>ck_repo_name</code> to <code>bc</code>. Also make sure you turn off the watcher.py script before making changes in <code>built_image</code>.</p> <p>Changes to the config files can be made directly in <code>/wagtail-kit/bc</code>.</p>"},{"location":"front-end-tooling/#developing-with-it","title":"Developing with it","text":"<ul> <li>To start the development environment, run <code>npm start</code> (or if that does not work <code>npm run serve</code>) - to stop this process press <code>ctrl + c</code>.</li> <li>This will start Browsersync and make the project available at <code>http://localhost:3000/</code>. If another process is using this port, check terminal for an updated URL. You can change this configuation by modifying the <code>browsersync.config.js</code> file, documented here https://www.browsersync.io/docs/options.</li> <li>Source files for developing your project are in <code>static_src</code> and the distribution folder for the compiled assets is <code>static_compiled</code>. Don't make direct changes to the <code>static_compiled</code> directory as they will be overwritten.</li> </ul>"},{"location":"front-end-tooling/#using-npm","title":"Using npm","text":"<ul> <li>Install all packages from <code>package.json</code>: <code>npm install</code></li> <li>Add new packages that are only required for development, e.g. tooling: <code>npm install --save-dev package_name</code> (this will add it to <code>package.json</code> and <code>package-lock.json</code> too)</li> <li>Add new packages required in production, e.g. react: <code>npm install --save-prod package_name</code></li> <li>To upgrade packages run <code>npm update package_name</code> or <code>npm update</code> to update them all.</li> </ul>"},{"location":"front-end-tooling/#tests","title":"Tests","text":"<p>JavaScript unit tests for this project use Jest. Here are commands you can use:</p> <pre><code># Run the whole test suite once.\nnpm run test\n# Run the whole test suite, collecting test coverage information.\nnpm run test:coverage\n# Start Jest in watch mode, to run tests on a subset of the files.\nnpm run test:watch\n</code></pre>"},{"location":"front-end-tooling/#deploying-it","title":"Deploying it","text":""},{"location":"front-end-tooling/#build-scripts","title":"Build scripts","text":"<p>To only build assets for either development or production you can use</p> <ul> <li><code>npm run build</code> To build development assets</li> <li><code>npm run build:prod</code> To build assets with minification and vendor prefixes</li> </ul>"},{"location":"front-end-tooling/#debug-script","title":"Debug script","text":"<p>To test production, minified and vendor prefixed assets you can use</p> <ul> <li><code>npm run debug</code> To develop with a simple http server, no browsersync and production assets</li> </ul>"},{"location":"front-end-tooling/#react-support","title":"React support","text":"<p>The wagtail-kit tooling now supports react out of the box.</p> <p>Note that react is installed as a dependency and imported via main.js.</p> <p>You can test that compilation of react is working by uncommenting the relevant lines in <code>javascript/main.js</code> and <code>javascript/components/test-react.js</code>. If you don't need react in your project, make sure you don't uncomment these lines or remove them completely. This will help to keep the compiled js file size down.</p>"},{"location":"front-end-tooling/#third-party-libraries","title":"Third party libraries","text":"<p>We no longer have a 'vendor' folder for these. Instead find ones that are packaged as npm libraries and install them as dependencies (see 'using npm' above). If they have CSS that needs including, this can be imported directly from the node_modules folder - see the example for glide in main.scss.</p>"},{"location":"front-end-tooling/#further-details-of-the-packages-included","title":"Further details of the packages included","text":"<ul> <li>autoprefixer - adds vendor prefixes as necessary for the browsers defined in <code>browserslist</code> in the npm config https://www.npmjs.com/package/autoprefixer</li> <li>babel-core - transpiler for es6 / react https://www.npmjs.com/package/babel-core</li> <li>babel-eslint - add-on for extra linting of experimental features (may not be necessary for all projects) https://www.npmjs.com/package/babel-eslint</li> <li>babel-jest - use Babel with Jest https://jestjs.io/docs/en/getting-started#using-babel</li> <li>babel-loader - use babel with webpack - https://www.npmjs.com/package/babel-loader</li> <li>babel-preset-env - babel preset for the latest version of es6, es2015   etc. https://www.npmjs.com/package/babel-preset-env https://babeljs.io/env/ https://babeljs.io/docs/plugins/</li> <li>browser-sync - for automatic reloading of your browser when changes are made to CSS / JS files https://www.npmjs.com/package/browser-sync</li> <li>css-loader \u2013 add support for Webpack to load stylesheets.</li> <li>cssnano \u2013 minify CSS with safe optimisations - https://cssnano.co/.</li> <li>eslint - lint your javascript https://www.npmjs.com/package/eslint</li> <li>jest - testing framework for JavaScript https://jestjs.io/</li> <li>sass - compiles Sass to CSS https://www.npmjs.com/package/sass</li> <li>\"mini-css-extract-plugin\" - extract CSS generated by Webpack into separate files.</li> <li>\"copy-webpack-plugin\" - reproduce path exactly when building static assets, in our case from <code>static_src/vendor</code> to <code>static_compiled/vendor</code>.</li> <li>npm-run-all - run more than one npm script concurrently - used by some of our npm scripts https://www.npmjs.com/package/npm-run-all</li> <li>onchange - watches for changes in a set of files - used by our watch scripts https://www.npmjs.com/package/onchange</li> <li>postcss-cli - required by <code>autoprefixer</code> - https://www.npmjs.com/package/postcss-cli</li> <li>\"postcss-loader\" - integrate PostCSS preprocessing into Webpack\u2019s styles loading.</li> <li>postcss-custom-properties - polyfill for CSS custom properties - https://www.npmjs.com/package/postcss-custom-properties</li> <li>stylelint - Linting for styles - https://stylelint.io</li> <li>sass-loader - integrate Sass preprocessing into Webpack\u2019s styles loading.</li> <li>webpack - Bundler for js files (can do much more too) - https://www.npmjs.com/package/webpack https://webpack.js.org/concepts/</li> <li>webpack-cli - The webpack command calls this behind the scenese (as of webpack v 4) https://www.npmjs.com/package/webpack-cli</li> </ul>"},{"location":"front-end-tooling/#react-specific-packages","title":"React specific packages","text":"<ul> <li>babel-polyfill - IE11 fallbacks for some js functions https://www.npmjs.com/package/babel-polyfill</li> <li>babel-preset-react - babel preset for react. https://www.npmjs.com/package/babel-preset-react https://babeljs.io/env/ https://babeljs.io/docs/plugins/</li> <li>eslint-plugin-react - linting for react and jsx https://www.npmjs.com/package/eslint-plugin-react</li> </ul>"},{"location":"hosting/","title":"Hosting","text":"<p>The VM comes preinstalled with Fabric, Heroku CLI and AWS CLI.</p>"},{"location":"hosting/#deployed-instances","title":"Deployed Instances","text":"Instance Branch URL Heroku Production <code>master</code> https://www.buckinghamshire.gov.uk <code>buckinghamshire-production</code> Staging <code>staging</code> https://buckinghamshire-staging.staging.torchbox.com <code>buckinghamshire-staging</code> Content Prep <code>master</code> https://buckinghamshire-content-prep.production.torchbox.com/ <code>buckinghamshire-content-prep</code> <p>Each instance has several subdomain URLs for:</p> <ul> <li>Recruitment site</li> <li>Internal recruitment site</li> <li>Family Information Service</li> <li>Care Advice Bucks</li> </ul> <p>See the <code>ALLOWED_HOSTS</code> environment variable and the Wagtail Sites settings on each instance for up to date details.</p>"},{"location":"hosting/#log-in-to-heroku","title":"Log in to Heroku","text":"<p>Please log in to Heroku before executing any commands for servers hosted there using the <code>Heroku login -i</code> command. You have to do it both in the VM and your host machine if you want to be able to use it in both places.</p>"},{"location":"hosting/#connect-to-the-shell","title":"Connect to the shell","text":"<p>To open the shell of the servers.</p> <pre><code>fab staging-shell\nfab production-shell\nfab content-prep-shell\n</code></pre>"},{"location":"hosting/#scheduled-tasks","title":"Scheduled tasks","text":"<p>When you set up a server you should make sure the following scheduled tasks are set.</p> <ul> <li><code>django-admin publish_scheduled_pages</code> - every 10 minutes or more often. This is necessary to make publishing scheduled pages work.</li> <li><code>django-admin clearsessions</code> - once a day (not necessary, but useful).</li> <li><code>django-admin update_index</code> - once a day (not necessary, but useful to make sure the search index stays intact).</li> <li><code>django-admin searchpromotions_garbage_collect</code> - once a day (by default 30 days of search hits will be retained, but it can be configured using the <code>WAGTAILSEARCH_HITS_MAX_AGE</code> environment variable).</li> </ul>"},{"location":"infrastructure/","title":"Infrastructure","text":"<p>See also Hosting for Heroku-specific documentation.</p>"},{"location":"infrastructure/#database","title":"Database","text":"<p>This project uses Postgres for its database.</p>"},{"location":"infrastructure/#pulling-data","title":"Pulling data","text":"<p>To populate your local database with the content of staging/production:</p> <pre><code>fab pull-staging-data\nfab pull-production-data\n</code></pre> <p>To fetch images and other media:</p> <pre><code>fab pull-staging-media\nfab pull-production-media\n</code></pre>"},{"location":"infrastructure/#cache","title":"Cache","text":""},{"location":"infrastructure/#front-end","title":"Front end","text":"<p>We use Cloudflare's front-end caching for the production site, according to request response headers.</p> <p>Cache purging is enabled as per https://docs.wagtail.io/en/stable/reference/contrib/frontendcache.html#cloudflare, using the limited-access API Token option, and a token with <code>Zone.Cache Purge</code> permission.</p>"},{"location":"infrastructure/#back-end","title":"Back end","text":"<p>We use Redis for back-end caching in Django.</p> <p>The Django low-level cache API is used by the recruitment API client to replace Zeep's default cache. See Recruitment Site for details.</p>"},{"location":"infrastructure/#search-engine","title":"Search engine","text":"<p>The search backend on staging and production is Elasticsearch, provided by Bonsai. See <code>heroku addons -a buckinghamshire-staging</code> (or \"production\"). To view the admin UI, <code>heroku addons:open bonsai -a buckinghamshire-staging</code> (or \"production\").</p> <p>The recruitment site uses Postgres for search. See <code>bc.recruitment.utils.get_job_search_results()</code>.</p>"},{"location":"infrastructure/#synonyms","title":"Synonyms","text":"<p>Search synonyms can be edited in the Wagtail admin, where any terms in the <code>synonyms</code> field will match any records whose index contains the term in the <code>canonical_term</code> field. Changes to the configured synonyms will not take place until the search is reindexed.</p>"},{"location":"infrastructure/#news-in-search","title":"News in Search","text":"<p>It was observed, that pages of the <code>NewsPage</code> type have been ranking fairly high in search results. This was undesirable, because news can be outdated and in the worst case plain wrong with respect to the situation at the time of search.</p> <p>To address this issue, multiple approaches (separate news search, no news in search, order news by date in results) were discussed. It was decided that news should still be discoverable through search but should rank much lower than other content, because of their time-limited value.</p> <p>To achieve a generally lower ranking of the <code>NewsPage</code> type, a query compiler mixin (<code>bc.search.elasticsearch7</code>) has been added that allows to apply a negative boost factor to search results with the content type <code>news.NewsPage</code>. This negative boost factor (which has to be a float between 0 and 1) can be defined throught the environment variable <code>SEARCH_BOOST_FACTOR_NEWS_PAGE</code> but defaults to 0.5. The negative boost factor is used to multiply the relevance score of a given search result, if that search result matches the content type <code>news.NewsPage</code>.</p> <p>See also: https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-boosting-query.html</p>"},{"location":"infrastructure/#developing-the-elasticsearch-search-engine-configuration","title":"Developing the Elasticsearch search engine configuration","text":"<p>The docker-compose set-up contains an ElasticSearch 7 instance to query against locally. When running this for the first time, run <code>dj update_index</code> to populate the index.</p> <p>Alternatively, use a free Bonsai sandbox Elasticsearch instance, and set these credentials locally, using the <code>bc.search.elasticsearch7</code> backend. An example of this configuration is in <code>bc/settings/local.py.example</code>.</p> <p>Be sure to run <code>dj update_index</code> before manually testing search features. This command will create (or update) the necessary index in Elasticsearch and fill it with the current content. If this is not run when a fresh Elasticsearch instance is used, then the index does not exist and the search requests will fail. (On production and staging this command is run during deployment and on a daily schedule to update the index content.)</p>"},{"location":"infrastructure/#wagtail-transfer","title":"Wagtail Transfer","text":"<p>This project uses Wagtail Transfer to allow transferring content between site instances. To enable the transfer between the instances, a few environment variables need to be defined.</p> <p>If an instance is supposed to serve as a source (in our case the staging instance) for imports to another instance, you need to configure the <code>WAGTAILTRANSFER_SECRET_KEY</code>. The <code>WAGTAILTRANSFER_SECRET_KEY</code> setting is used to authenticate the communication between the source and destination instances. This environment variable only needs to be set on source instances.</p> <p>On the destination site, you need to configure <code>WAGTAILTRANSFER_SOURCE_KEY</code> and <code>WAGTAILTRANSFER_SOURCE_URL</code>. <code>WAGTAILTRANSFER_SOURCE_KEY</code> on the destination instance needs to match the <code>WAGTAILTRANSFER_SECRET_KEY</code> used on the source instance. E.g. if on the staging instance you have used <code>WAGTAILTRANSFER_SECRET_KEY=\"abc123\"</code> (which is not recommended), then you would set <code>WAGTAILTRANSFER_SOURCE_KEY=\"abc123</code> on the production instance. </p> <p>Additionally, you need to configure <code>WAGTAILTRANSFER_SOURCE_URL</code> on the destination instance, so that Wagtail Transfer knows the endpoint to send its requests to. E.g. on production you might set: <code>WAGTAILTRANSFER_SOURCE_URL=\"https://staging.example.com/wagtail-transfer/\"</code></p> <p>Additionally, you can set the <code>WAGTAILTRANSFER_SOURCE_LABEL</code> on the destination instance. <code>WAGTAILTRANSFER_SOURCE_LABEL</code> defines the name that will show up in the admin to select the source instance. Use only valid Python variable names (i.e. no <code>-</code> is allowed.). E.g. on the production instance you might want to set this to \"ContentPrep\".</p> <p>You can configure a second source instance, by adding a second set of environment variables with a <code>_2</code> suffix, e.g. <code>WAGTAIL_TRANSFER_SOURCE_KEY_2</code> etc.</p>"},{"location":"infrastructure/#configured-instances-and-deployments","title":"Configured Instances and Deployments","text":"<p>The project has three Heroku instances: Staging, Production, and Content Prep. Wagtail Transfer is intended to be used between the Content Prep and Production instances. See Deployed Instances.</p> <p>Whenever deploying new features to Production, they should be deployed also to Content Prep, to keep the two sites in sync. See Deploying to production.</p>"},{"location":"infrastructure/#resetting-the-staging-site","title":"Resetting the Staging site","text":"<p>Steps for resetting the <code>staging</code> git branch, and deploying it with a clone of the production site database.</p>"},{"location":"infrastructure/#pre-flight-checks","title":"Pre-flight checks","text":"<ol> <li>Is this okay with the client, and other developers?</li> <li>Is there any test content on staging that may need to be recreated, or be a reason to delay?</li> <li> <p>What branches are currently merged to staging?</p> <pre><code>$ git branch -a --merged origin/staging &gt; branches_on_staging.txt\n$ git branch -a --merged origin/master &gt; branches_on_master.txt\n$ diff branches_on_{master,staging}.txt\n</code></pre> </li> <li> <p>Take note if any of the listed branches are stale. Stale branches do not need to be recreated.</p> </li> <li>Are there any user accounts on staging only, which will need to be recreated? Check with the client, and record them.</li> <li>Take a backup of staging<pre><code>$ heroku pg:backups:capture -a buckinghamshire-staging\n</code></pre> </li> </ol>"},{"location":"infrastructure/#git","title":"Git","text":"<ol> <li> <p>Reset the staging branch</p> <pre><code>$ git checkout staging &amp;&amp; git fetch &amp;&amp; git reset --hard origin/master &amp;&amp; git push --force\n</code></pre> </li> <li> <p>Tell your colleagues</p> <p>@here I have reset the staging branch. Please delete your local staging branches</p> <p><code>$ git branch -D staging</code></p> <p>to avoid accidentally merging in the old version</p> </li> <li> <p>Force-push to Heroku, otherwise CI will later fail</p> <pre><code>$ git push --force heroku-staging master\n</code></pre> </li> <li> <p>Merge in the relevant branches</p> <pre><code>$ git merge --no-ff origin/feature/123-extra-spangles\n</code></pre> </li> <li> <p>Check for any newly necessary merge migrations</p> <pre><code>$ ./manage.py makemigrations --check\n</code></pre> </li> </ol>"},{"location":"infrastructure/#database_1","title":"Database","text":"<ol> <li> <p>List production database backups:</p> <pre><code>$ heroku pg:backups -a buckinghamshire-production\n</code></pre> </li> <li> <p>Get a signed S3 URL of your chosen backup:</p> <pre><code>$ heroku pg:backups:url {backup-name} -a buckinghamshire-production\n</code></pre> </li> <li> <p>Upload to staging. This is a destructive action. Proofread it thoroughly.</p> <pre><code>$ heroku pg:backups:restore {backup-url} DATABASE_URL -a buckinghamshire-staging\n</code></pre> </li> <li> <p>Delete any personally-identifying data from staging. See Data protection for instructions.</p> </li> </ol> <p>The site is mostly read-only for end users. User actions which write to the site database include any actions in the Wagtail admin, plus on the site front end:</p> <ul> <li>Search queries (Wagtail stores popular queries)</li> <li>Subscribing to job search alerts \u2014 see Feature flags below</li> <li>Wagtail FormPage instances</li> <li>Page footer feedback form \u2014 see Feature flags below</li> </ul> <p>See Data protection for details of which store PII.</p>"},{"location":"infrastructure/#media","title":"Media","text":"<p>The fab commands are sufficient here. It's quicker just to copy original image files across (with no renditions):</p> <pre><code>$ fab pull-production-images\n$ fab push-staging-images\n</code></pre> <p>\u2026otherwise if you need everything, i.e. uploaded documents, images and renditions:</p> <pre><code>$ fab pull-production-media\n$ fab push-staging-media\n</code></pre>"},{"location":"infrastructure/#cleanup","title":"Cleanup","text":"<ol> <li>Check the staging site loads</li> <li>Update the Wagtail Site records, as the database will contain the production URLs</li> <li>Check CI is working https://git.torchbox.com/buckinghamshire-council/bc/pipelines</li> </ol>"},{"location":"infrastructure/#comms","title":"Comms","text":"<p>Inform the client of the changes.</p> <ul> <li>All user accounts have been copied across, so your old staging password will no longer work. Log in with your production password (and then change it), or use the 'forgot password' feature.</li> <li>Any test content has been reset. This is probably the biggest inconvenience. Sorry.</li> <li>I have deleted the personally-identifying data from form submissions and job alert subscriptions. If there's any more on production (there shouldn't be) then please let me know and I'll remove it from staging.</li> </ul>"},{"location":"infrastructure/#feature-flags","title":"Feature flags","text":"<p>The following features can be deactivated with environment variables</p>"},{"location":"infrastructure/#job-search-alerts","title":"Job search alerts","text":"<p>Set <code>ENABLE_JOBS_SEARCH_ALERT_SUBSCRIPTIONS=false</code> in environment variables. This removes the form from the job search results page, but does not disable the corresponding view.</p>"},{"location":"infrastructure/#feedback-widget","title":"Feedback widget","text":"<p>Set <code>ENABLE_FEEDBACK_WIDGET=false</code> in environment variables. This removes the form from the page footer, but does not disable the corresponding views.</p>"},{"location":"infrastructure/#cross-site-request-forgery-csrf-protection","title":"Cross-Site Request Forgery (CSRF) Protection","text":"<p>Including values in the <code>CSRF_TRUSTED_ORIGINS</code> setting in your Django deployment is crucial for bolstering security, especially in multi-domain environments. By specifying trusted domains from which form submissions are accepted without requiring CSRF tokens, you strike a balance between security and usability.</p> <p>This ensures that legitimate requests from trusted domains proceed smoothly while still protecting against CSRF attacks from untrusted sources. In essence, <code>CSRF_TRUSTED_ORIGINS</code> helps prevent false positives and enhances the overall security posture of your application by allowing you to explicitly define trusted origins for CSRF protection.</p> <p>To set the value on Heroku:</p> <p>Using Heroku CLI</p> <ol> <li>Open your terminal or command prompt.</li> <li>Log in to your Heroku account using the Heroku CLI:</li> </ol> <pre><code>heroku login\n</code></pre> <ol> <li>Navigate to your Django project directory.</li> <li>Set the <code>CSRF_TRUSTED_ORIGINS</code> config variable using the Heroku CLI:</li> </ol> <pre><code>heroku config:set CSRF_TRUSTED_ORIGINS=your_trusted_origin_here\n</code></pre> <ol> <li>Replace <code>your_trusted_origin_here</code> with the domain(s) you want to trust for CSRF protection. If you have multiple origins, separate them with commas.</li> </ol> <p>Using Heroku Dashboard</p> <ol> <li>Log in to your Heroku account and navigate to your Heroku Dashboard.</li> <li>Select your Django application from the list of apps.</li> <li>Go to the \"Settings\" tab.</li> <li>Scroll down to the \"Config Vars\" section.</li> <li>Click on the \"Reveal Config Vars\" button if it's not already visible.</li> <li>Add a new config var with the key <code>CSRF_TRUSTED_ORIGINS</code> and specify the trusted origin(s) as the value. If you have multiple origins, separate them with commas.</li> <li>Click \"Add\" or \"Save\" to save the changes.</li> </ol> <p>Once you've set the <code>CSRF_TRUSTED_ORIGINS</code> config variable on Heroku, your Django application will use the specified trusted origins for CSRF protection. Make sure to restart your Heroku application after making these changes for them to take effect.</p>"},{"location":"infrastructure/#frame-ancestors","title":"Frame ancestors","text":"<p>If a <code>CSP_FRAME_ANCESTORS</code> environment variable is present it will be used as a <code>Content-Security-Policy: frame-ancestors</code> header, allowing the domains listed to embed the sites in an iframe.</p> <p>Only trusted domains should be added to this list.</p> <p>If present, the variable should be a comma-separated list with items of the form:</p> <ul> <li><code>'self'</code> (the quotes are required) to allow the site to embed itself;</li> <li><code>'none'</code> (quotes here are alos required) to ban the site from being embedded;</li> <li><code>https://example.com</code> (the protocol <code>http://</code> or <code>https://</code> is required).</li> </ul>"},{"location":"live-chat-client/","title":"Live Chat Client","text":"<p>This is a front-end client provided by Click4Access. The only project code for this is hardcoded in the <code>base.html</code> template, and a boolean field to turn it on per-page at <code>bc.utils.models.BasePage</code>.</p> <p>It sets cookies. See the cookie documentation about the project's approach to this.</p>"},{"location":"location-autocomplete/","title":"Location autocomplete widget","text":"<p>Directory search widget streamfield block has a location autocomplete field.</p> <p>The HTML template of the block can be found at bc/project_styleguide/templates/patterns/molecules/location-autocomplete/location-autocomplete.html.</p> <p>The JavaScript component can be found at bc/static_src/javascript/components/location-autocomplete.js.</p> <p>It uses Google Maps API to provide location suggestions: https://developers.google.com/maps/documentation/javascript/reference/places-autocomplete-service</p>"},{"location":"location-autocomplete/#configuration","title":"Configuration","text":"<p>It requires the <code>GOOGLE_MAPS_V3_APIKEY</code> environment variable to be configured. This settings is also used by different components on the website (e.g. location maps widget).</p>"},{"location":"location-maps-widget/","title":"Location maps widget","text":"<p>We use Wagtail-Geo-Widget as a widget for location coordinates. It uses Google Maps internally.</p>"},{"location":"location-maps-widget/#configuration","title":"Configuration","text":"<p>Set the environment variables</p> <ul> <li><code>GOOGLE_MAPS_V3_APIKEY</code> (Stored in Bitwarden under \"Google Maps Embed Local Development API Key\")</li> </ul> <p>This variable is also used by the location autocomplete widget.</p>"},{"location":"postcode-lookup/","title":"Location based lookup","text":"<p>The site integrates with a Buckinghamshire Council geolocation API to determine what legacy council websites provide information for a user based on their address.</p>"},{"location":"postcode-lookup/#buckinghamshire-council-mapping-tool","title":"Buckinghamshire Council mapping tool","text":"<p>This is a tool hosted at maps.buckinghamshire.gov.uk, built by exporting from the council's gazetteer into a geospatial database.</p> <p>No authentication is required to query this API.</p> <p>This is used By the LocalAreaLinksBlock StreamField block to match a submitted postcode to one of the four areas of Buckinghamshire Council, matching those served by the former district councils. A postcode query returns a list of street addresses, and a corresponding 'District Council' parameter.</p> <p>If all the results for a query match a single district council (most queries), we redirect the user to the correct site. Otherwise we ask the user to give their street address.</p>"},{"location":"postcode-lookup/#configuration","title":"Configuration","text":"<p>The Python client is at <code>bc.area_finder.client.BucksMapsClient</code>. The timeout for the upstream API can be configured with the environment variable:</p> <ul> <li><code>BUCKS_MAPS_CLIENT_API_TIMEOUT_SECONDS</code> (must be parsable as a <code>float</code>; defaults to <code>10</code>)</li> <li>Retries are implemented to handle a Sentry ConnectionError see in production.</li> <li><code>backoff_factor</code>: Increase in sleep time between retries (10%).</li> <li><code>status_forcelist</code>: List of status codes to retry on.</li> <li><code>allowed_methods</code>: Set of uppercased HTTP method verbs for retries.</li> </ul>"},{"location":"project-conventions/","title":"Project Conventions","text":""},{"location":"project-conventions/#code-styleguide","title":"Code styleguide","text":"<p>This project\u2019s code formatting is enforced with Prettier for supported languages. Make sure to have Prettier integrated with your editor to auto-format when saving files, or to manually run it before committing (<code>npm run format</code>).</p> <p>Python code is formatted with Black. Run automatic fomatting with <code>black .</code> in the VM or on your host machine.</p> <p>These style conventions are enforced through CI pipelines.</p>"},{"location":"project-conventions/#git-branching-model","title":"Git branching model","text":"<p>The following resources are for internal project developers. Open source contributors please refer to the contribution guidelines.</p> <p>We follow a loose version of the Git flow branching model. A summary would be \"like git-flow, but 'develop' is called 'release'\".</p> <ul> <li>Make pull requests against: <code>release</code></li> <li>The release prep branch is: <code>release</code></li> <li>Start new features by branching from: <code>release</code></li> <li>Start bug fixes by branching from: <code>master</code></li> <li>The client QA branch is: <code>staging</code></li> <li>The internal QA branch is: <code>staging</code></li> <li>Do not treat the following branches as merge sources: <code>staging</code></li> </ul> <p>To create a new feature or bugfix, use the following process.</p> <ol> <li>Make changes on a new branch, including a broad category and the ticket number if relevant e.g. <code>feature/123-extra-squiggles</code>, <code>fix/newsletter-signup</code>.</li> <li>Summarise your changes in <code>CHANGELOG.md</code>. Sort lines by ticket number (this makes merge and deployment diffs simpler).</li> <li>Push your branch to the remote.</li> <li>Make merge requests at https://git.torchbox.com/buckinghamshire-council/bc/merge_requests/new, setting the 'Source branch' to your feature branch and the 'Target branch' to <code>release</code>. Select 'Compare branches and continue'.</li> <li>Edit details as necessary. Use the MR templates configured in GitLab, and the checkboxes therein and project labels to illustrate the current status of the MR.</li> </ol> <p>If you need to preview work on <code>staging</code>, this can be merged and deployed manually without making a merge request. You can still make the merge request as above, but add a note to say that this is on <code>staging</code>, and not yet ready to be merged to <code>release</code>.</p> <p>NB The MR templates are in version control at <code>.gitlab/merge_request_templates/</code>.</p>"},{"location":"project-conventions/#deployment-cycle","title":"Deployment Cycle","text":""},{"location":"project-conventions/#versioned-releases","title":"Versioned releases","text":"<p>The version number is of the form <code>MAJOR.PATCH</code>. Planned releases which add features increase the major version number. Bug fix releases increase the patch number.</p> <ol> <li>Make merge requests to the branch <code>release</code>.</li> <li>Add a heading <code># x.x (yyyy-mm-dd)</code> to <code>CHANGELOG.md</code>, detailing what is in this release.</li> <li>Add a comparison link below the <code>x.x</code> heading (see other releases for syntax; note that this will not work until the release is tagged, below)</li> <li>Merge <code>release</code> to <code>master</code>.</li> <li>Deploy to Production and Content Prep (see continuous deployment documentation).</li> <li>Tag the merge commit</li> <li><code>git tag x.x</code></li> <li><code>git push --tags</code></li> </ol> <p>Tidy up: merge <code>master</code> to <code>staging</code>, and if necessary back to <code>release</code>. Check the repository graph looks sensible (https://git.torchbox.com/buckinghamshire-council/bc/-/network/master).</p>"},{"location":"project-conventions/#deploying-bug-fixes","title":"Deploying bug fixes","text":"<p>Urgent bug fixes should be made against the latest-deployed release, i.e. x.x.</p> <ol> <li>Pull <code>master</code>.</li> <li>Create the bug fix branch, e.g. <code>hotfix/mend-squiggles</code>.</li> <li>In <code>CHANGELOG.md</code>, add a new section to <code>x.(x+1) (yyyy-mm-dd)</code> where the       date is the release date.</li> <li>Add a comparison link below the <code>x.x</code> heading (see other releases for syntax; note that this will not work until the release is tagged, below)</li> <li>If it needs client approval, or to be user-tested, deploy to staging.</li> <li>Make a merge request from <code>hotfix/mend-squiggles</code> to <code>master</code>.</li> <li>Once the change is approved, accept the merge request, and deploy to    Production and Content Prep</li> <li>Tag the merge commit</li> <li><code>git tag x.(x+1)</code></li> <li><code>git push --tags</code></li> <li>Merge master into <code>release</code>.</li> </ol>"},{"location":"recruitment-site/","title":"Recruitment Site","text":"<p>This is hosted at https://jobs.buckinghamshire.gov.uk/. It is a Django/Wagtail app sitting within the main project, with a set of page types for this site only, including its own home page type.</p>"},{"location":"recruitment-site/#internal-recruitment-site","title":"Internal Recruitment Site","text":"<p>There is also a recruitment site for internal jobs. This is hosted on TBC. It is a clone of the main recruitment site with different jobs and job alert associated.</p> <p>Each recruitment site will display different job listing. Many jobs may be posted to both sites. The jobs on each site will have a different <code>talentlink_id</code> though they will share the same <code>job_number</code>.</p> <p>Note that categories and subcategories are shared across the recruitment sites.</p>"},{"location":"recruitment-site/#local-development","title":"Local development","text":"<p>Either grab a database dump from production or staging, or:</p> <ol> <li>At root, add a Job home page</li> <li>Edit sites (/admin/sites/), and add a new site for job homepage, selecting the newly created job homepage as home page</li> <li>Update sites settings:</li> <li>Update sites settings to use the local domain for job homepage</li> <li>Update your /etc/hosts with the new job domain if needed. Eg. mine is 127.0.0.1 jobs.bc.local bc.local</li> <li>In VM, run <code>dj import_jobs</code> (see below about credentials). You should see something like \"Fetching page 1... 140 new jobs created.\" (If you get <code>JobCategory.DoesNotExist</code> errors, run the import command with <code>dj import_jobs --import_categories</code>. This will import the missing categories).</li> <li>Jobs are imported as TalentLinkJob models, and not page models. So you won't see the pages. To view a job page, you will need to append <code>/job_detail/&lt;talentlink_id&gt;/</code>. Eg. http://jobs.bc.local:8000/job_detail/123/</li> <li>You can view imported jobs in the Wagtail admin at e.g. http://jobs.bc.local:8000/admin/recruitment/talentlinkjob/</li> </ol>"},{"location":"recruitment-site/#credentials","title":"Credentials","text":"<p>The following environment variables must be set to authenticate with the API (or configured in local settings, for dev enviromnents):</p> <ul> <li><code>TALENTLINK_API_KEY</code></li> <li><code>TALENTLINK_API_PASSWORD</code></li> <li><code>TALENTLINK_API_USERNAME_EXTERNAL</code></li> <li><code>TALENTLINK_API_USERNAME_INTERNAL</code></li> <li>And potentially <code>TALENTLINK_API_USERNAME_{uppercase job board name}</code> for any new boards</li> <li><code>TALENTLINK_APPLY_CONFIG_KEY_EXTERNAL</code></li> <li><code>TALENTLINK_APPLY_CONFIG_KEY_INTERNAL</code></li> <li>And potentially <code>TALENTLINK_APPLY_CONFIG_KEY_{uppercase job board name}</code> for any new boards</li> <li><code>TALENTLINK_API_WSDL</code>, this is configurable, but not secret, and should be set to \"https://api3.lumesse-talenthub.com/CareerPortal/SOAP/FoAdvert?WSDL\"</li> </ul>"},{"location":"recruitment-site/#soap","title":"SOAP","text":"<p>Jobs are fetched from the Lumesse TalentLink SOAP API. We use Zeep as an API client.</p> <p>API documentation is at https://developer.lumesse-talenthub.com/docs.html. From there we use the \"Fo Advert\" bundle.</p> <p>You can use zeep to inspect the (undocumented) WSDL file for that API:</p> <pre><code>python -mzeep https://api3.lumesse-talenthub.com/CareerPortal/SOAP/FoAdvert?WSDL\n</code></pre> <p>This is done in code too, at the point where the internal <code>zeep.Client</code> is configured. It populates 'service' methods on the client, corresponding to the services documented at https://developer.lumesse-talenthub.com/docs/read/career_portal/FoAdvert.html.</p>"},{"location":"recruitment-site/#zeep","title":"Zeep","text":""},{"location":"recruitment-site/#authentication-with-lumesse-talentlink","title":"Authentication with Lumesse TalentLink","text":"<p>The Lumesse TalentLink API uses both WS-Security (the request body contains a username and password in the Header element) and requires an API key to be supplied as a URL query parameter. We have modified the Zeep Transport class to add this API key to all URLs.</p>"},{"location":"recruitment-site/#use-with-django-cache","title":"Use with Django cache","text":"<p>Zeep caches WSDL schemata internally. We use a custom <code>ZeepDjangoBackendCache</code> to fit with the infrastructure Django already provides. See Infrastructure for details of the Django backend.</p>"},{"location":"recruitment-site/#lumesse-talentlink-api","title":"Lumesse TalentLink API","text":"<p>Every service documented at https://developer.lumesse-talenthub.com/docs/read/career_portal/FoAdvert.html has a corresponding service method on the client, e.g. there's a service in the documentation called 'getAdvertisements', corresponding to the WSLD service of the same name:</p> <pre><code>getAdvertisements(\n    firstResult: xsd:int,\n    maxResults: xsd:int,\n    searchCriteriaDto: ns0:searchCriteriaDto,\n    sortingDetailsDto: ns0:sortingDetailsDto,\n    langCode: ns0:langCode,\n    showJobLocation: xsd:boolean,\n    displayFullContent: xsd:boolean) -&gt; advertisementResult: ns0:advertisementResultDto\n</code></pre> <p>You can call this in Python code with:</p> <pre><code>&gt;&gt;&gt; from bc.recruitment_api.client import get_client\n&gt;&gt;&gt; client = get_client()\n&gt;&gt;&gt; resp = client.service.getAdvertisements(1, 10)\n&gt;&gt;&gt; resp['totalResults']\n136\n&gt;&gt;&gt; len(resp['advertisements']['advertisement'])\n10\n&gt;&gt;&gt; dir(resp['advertisements']['advertisement'][0])\n['applicationUrl', 'assignedImages', 'categoryLists', 'comment', 'compensationMaxValue', 'compensationMinValue', 'configurableFields', 'contractCompensationPeriod', 'contractDuration', 'customFields', 'customLovs', 'descriptionUrl', 'dueDate', 'duration', 'expectedEndDate', 'expectedStartDate', 'externalJobNumber', 'generalApplication', 'id', 'indeedConfiguration', 'jobLocations', 'jobNumber', 'jobTitle', 'jobUpdateDate', 'keyword', 'language', 'location', 'operationals', 'organizations', 'postingEndDate', 'postingStartDate', 'postingTargetStatus', 'postingUserEmail', 'recruiters', 'recruitingCompany', 'requisitionInternalJobNumber', 'showCompensation', 'showRecruiter', 'siteLanguage', 'sponsoredJobContext', 'standardLovs', 'standardRate', 'status', 'strapline']\n&gt;&gt;&gt; resp['advertisements']['advertisement'][0]['jobTitle']\n'2 x Support Workers - Autism - Spring Valley Day Centre / Spectrum Unit'\n</code></pre>"},{"location":"recruitment-site/#saba","title":"Saba","text":"<p>Saba is the system used for managing jobs and applications.</p> <p>Jobs are identified by a unique job number, eg. BUC0003 which corresponds to <code>TalentLinkJob.job_number</code> on the Wagtail site.</p> <p>On Saba, jobs can have multiple advertisements. Advertisements can be posted to multiple targets. Each posting target (ie. job board) has its own TalentLink API credentials. We are currently only importing job advertisements posted to 'External site' and 'Internal site' on Saba.</p> <p>Each job advertisement posting to a job board will have a start date, end date, and status. It will only appear on the TalentLink API feed for the job board if its status is 'Published'.</p> <p>The posting will also have a unique ad id which corresponds to <code>TalentLinkJob.talentlink_id</code>. This is different for each job board, even if it is from the same job advertisement.</p>"},{"location":"recruitment-site/#importing-jobs","title":"Importing jobs","text":"<p>The management command <code>import_jobs</code> will fetch results from the API.</p> <p>If the <code>--import_categories</code> option is specified when running the <code>import_jobs</code> command, new categories will be imported. Otherwise, jobs with categories that do not match existing <code>JobSubcategory</code> instances will be skipped in the import.</p> <p><code>JobSubcategory</code> objects are unique by title, but looked up case-insensitively by the importer. This is due to similar entries like \"Schools secondary\" and \"Schools Secondary\" in the source data.</p> <p>Note that the imported <code>Job Group</code> attribute from the API is mapped to the <code>JobSubcategory</code> model in Django, but that users can filter by either category or subcategory. The relationship between categories and their subcategories can be edited in the Wagtail admin.</p>"},{"location":"recruitment-site/#job-boards-ie-external-and-internal-job-sites","title":"Job Boards (ie. External and Internal job sites)","text":"<p>Jobs on TalentLink can be posted to multiple job boards (eg. External or Internal). The job board is set on the recruitment homepage (go to the Settings tab).</p> <p>Each TalentLinkJob instance belongs to only one recruitment site.</p> <p>The import script loops through the instances of recruitment homepage on the system and import jobs for the job board defined on the instance.</p> <p>If a corresponding API_USERNANE for the job board (eg. <code>settings.TALENTLINK_API_USERNAME_EXTERNAL</code>) is not defined on settings, import will be skipped for the recruitment site.</p>"},{"location":"recruitment-site/#imported-fields","title":"Imported fields","text":"<p>This is a non-exhaustive reference of the fields we map from the API return. It serves to highlight some of the noteworthy aspects:</p>"},{"location":"recruitment-site/#description","title":"Description","text":"<p>This is a concatenation of multiple <code>custom_field</code> fields, whose format is a 'label' and a 'value'. We turn the label into a <code>&lt;h3&gt;</code> element, and the value into a paragraph, but we also strip out most HTML formatting, according to a whitelist of tags and their attributes in <code>bc.recruitment_api.constants</code>.</p>"},{"location":"recruitment-site/#short-description","title":"Short description","text":"<p>This is either the text of the first <code>&lt;p&gt;</code> element in the first custom_field value from above, or the entire first custom_field value, if it is formatted as plain text.</p>"},{"location":"recruitment-site/#logo","title":"Logo","text":"<p>Logo images are pulled from their remote location and imported to Wagtail's image library. If an image doesn't pass Wagtail's validation, it's rejected and the field left blank. This means that some images allowed by TalentLink may not be imported - e.g. if they exceed the size allowed by the <code>MAX_IMAGE_PIXELS</code> setting.</p>"},{"location":"recruitment-site/#job-alerts","title":"Job Alerts","text":""},{"location":"recruitment-site/#management-command","title":"Management command","text":"<pre><code>dj send_job_alerts\n</code></pre> <p>This searches for new matches for all confirmed job alert subscriptions.</p> <p>A new match is any job whose created date is since the start of the last successful run, and since the alert was created.</p> <p>The way the command is written intends it to be called daily, but other durations shouldn't matter, so long as the duration is longer than the time taken for the command to run. It specifically ignores jobs imported during the running of the alert command, leaving them for the next alert cycle.</p> <p>Job alerts are site specific.</p>"},{"location":"recruitment-site/#application-forms","title":"Application forms","text":"<p>This function is provided by the RAC, Responsive Application Component, a front-end application developed and supplied as-is by Saba Talentlink.</p> <p>This was originally developed by them and styled to match the previous county council's recruitment site, but is now styled by us.</p> <p>The vendor static files are in <code>/bc/static_src/vendor/talentlink/</code>, (though only the JS is still in use), and the HTML in <code>bc/project_styleguide/templates/patterns/pages/jobs/apply.html</code>. We have kept the layout of the HTML file fairly close to the originally-supplied file, with commented-out header tags etc., to make it easier to understand the diff in future if an updated file is supplied by Saba.</p>"},{"location":"service-directory/","title":"Service directory","text":"<p>Service directory API is used to provide a list of services available.</p> <p>This is used on the Directory Services StreamField block on location pages.</p> <p>The directories are external systems that provide a list of services available in the area, for example: https://directory.familyinfo.buckinghamshire.gov.uk/. We built the streamfield block to output some of that data on the Wagtail website.</p> <p>The data fetched from the API is:</p> <ul> <li>Taxonomy (the categories)</li> <li>Services (the activities)</li> </ul> <p>Data is fetched from two separate API endpoints:</p> <ul> <li>Services are fetched from the specific directory endpoint,   for example: <code>https://api.familyinfo.buckinghamshire.gov.uk/</code>.</li> <li>Taxonomy options are fetched from the directory management endpoint,   for example: <code>https://manage-directory-listing.buckinghamshire.gov.uk/api/v1/taxonomies</code>.</li> </ul> <p>Those API endpoints are public. If we hit rate limiting errors, the supplier can provide us with a private token.</p> <p>Those APIs are not managed by Torchbox.</p>"},{"location":"service-directory/#taxonomy-fetch","title":"Taxonomy fetch","text":"<p>Taxonomy fetch happens on a schedule using a management command. That needs to be set up on Heroku scheduler or equivalent.</p> <pre><code> ./manage.py fetch_service_directory_taxonomies\n</code></pre>"},{"location":"service-directory/#services-fetch","title":"Services fetch","text":"<p>Services are fetched by Directory Services StreamField block on location pages.</p> <p>That is done on the view when the page request happens.</p>"},{"location":"service-directory/#api-data-parsing-and-validation","title":"API data parsing and validation","text":"<p>Parsing and validation is done using https://github.com/lidatong/dataclasses-json/. Expect to see validation error exceptions if API shape changes.</p>"},{"location":"service-directory/#configuration","title":"Configuration","text":"<p>The API endpoints are configured in Wagtail admin under \"Service directory\" -&gt; \"Directories\" and \"Service directory\" -&gt; \"Management APIs\".</p>"},{"location":"technical-debt/","title":"Technical debt","text":"<p>This page describes known technical debt or shortcomings in the project.</p>"},{"location":"technical-debt/#non-family-info-sites-and-pages-using-family_info-django-applications-code","title":"Non-family info sites and pages using <code>family_info</code> Django application's code","text":"<p>There are subsites set up using <code>family_info</code> Django application's models that are not family info subsite.</p> <p>A likely good idea would be to refactor the <code>family_info</code> Django application to be more generic and move the family info specific code to a separate Django application.</p> <p>This may be especially confusing for new developers trying to find their way in the codebase.</p> <p>Short-term actions to address:</p> <ul> <li>Any FIS-named code should be reviewed and checked if it should be called something else.</li> <li>Add comments around FIS-named things whether they are actually FIS-specific.</li> <li>Document this somewhere else</li> </ul> <p>Ideally:</p> <ul> <li>Formulate plan for renaming the code.</li> <li>Migrate existing subsites to use generic, non-FIS code as much as possible.</li> <li>Any new subsites should use generic, non-FIS code only.</li> </ul> <p>We don't want to be in situation where FIS-specific code is used for non-FIS subsites.</p>"},{"location":"upgrading/","title":"Upgrading guidelines","text":"<p>This document describes aspects of the system which should be given particular attention when upgrading Wagtail or its dependencies.</p>"},{"location":"upgrading/#wagtail-package-dependencies","title":"Wagtail package dependencies","text":"<p>We are maintaining our own forks of Wagtail packages at: https://github.com/torchbox-forks.</p> <p>The enables any team member to propose a change to a package, we can all work directly on the work branch and submit it to the original author for consideration.</p> <ul> <li>How we work on forked packages (intranet article).</li> <li>Where we manage forked packages (Monday board).</li> </ul> <p>As much as possible, we want to use the official releases available on PyPI for the Wagtail package dependencies. A temporary solution is to fork the package dependency, tag the working branch, and use the tag in the pyproject file.</p>"},{"location":"upgrading/#check-these-packages-for-updates","title":"Check these packages for updates","text":"<p>Last tested for wagtail 6.3 upgrade Comments in the pyproject.toml file may have more detailed information.</p> <ul> <li>wagtail-django-recaptcha</li> </ul> <p>It is important to replace the usage of the git tags in the pyproject.toml file with the official release version from PyPI as soon as they become available.</p>"},{"location":"upgrading/#upgrade-tooling","title":"Upgrade tooling","text":"<p>django-upgrade and pyupgrade are available to help with upgrading Django and Python code respectively.</p> <p>Please check that the versions in use are up to date and consider running these tools to help with the upgrade process. Check the pyproject.toml and the pre-commit configuration for the versions in use.</p>"},{"location":"upgrading/#critical-paths","title":"Critical paths","text":"<p>The following areas of functionality are critical paths for the site which don't have full automated tests and should be checked manually.</p> <p>(If this information is managed in a separate document, a link here will suffice.)</p>"},{"location":"upgrading/#1-summary-of-critical-path-eg-donations","title":"1. [Summary of critical path, e.g. 'Donations']","text":"<p>[Description of the overall functionality covered]</p> <ul> <li>Step-by-step instructions for what to test and what the expected behaviour is</li> <li>Include details for edge cases as well as the general case</li> <li>Break this into separate subsections if there's a lot to cover</li> <li>Don't include anything which is already covered by automated testing, unless it's a prerequisite for a manual test</li> </ul>"},{"location":"upgrading/#other-considerations","title":"Other considerations","text":"<p>As well as testing the critical paths, these areas of functionality should be checked:</p> <ul> <li>...</li> <li>Other places where you know extra maintenance or checks may be necessary</li> <li>This could be code which you know should be checked and possibly removed - e.g. because you've patched something until a fix is merged in a subsequent release.</li> <li>Any previous fixes which may need to be updated/reapplied on subsequent upgrades</li> <li>Technical debt which could be affected by an upgrade.</li> </ul>"},{"location":"custom-features/form-builder/","title":"Formbuilder customisations","text":"<p>This project uses a custom <code>bc.forms</code> app that extends Wagtail's <code>contrib.forms</code></p>"},{"location":"custom-features/form-builder/#submission-auto-deletion","title":"Submission auto-deletion","text":"<p>The <code>FormPage</code> model in <code>bc.forms</code> has a custom <code>auto_delete</code> field. When set to a non-zero value (zero is the default), form submissions for that form will be deleted after that many days.</p> <p>This is done via a custom <code>stale_submissions</code> management command that's meant to be run daily.</p>"},{"location":"custom-features/form-builder/#embedded-form-blocks","title":"Embedded form blocks","text":"<p>There's a custom <code>EmbeddedFormBlock</code> that allows an editor to pick a <code>FormPage</code> and have the form for that page be embedded inside the streamfield.</p> <p>The form submission is handled by the original <code>FormPage</code> view, so any validation error will be displayed on the non-embedded form page. Otherwise the form's submission is recorded and a \"thank you\" message (configurable) is displayed (embedded).</p>"}]}