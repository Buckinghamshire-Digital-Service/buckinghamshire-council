{% extends "patterns/base.html" %}

{% load static wagtailuserbar wagtailcore_tags wagtailimages_tags alert_tags navigation_tags util_tags %}

{% block meta_tags %}
    {% if GOOGLE_TAG_MANAGER_ID %}
        {% include "patterns/pages/includes/GTM/script_head.html" %}
    {% endif %}

    {% if YANDEX_VERIFICATION_STRING %}
        <meta name="yandex-verification" content="{{ YANDEX_VERIFICATION_STRING }}" />
    {% endif %}

    {% wagtail_site as current_site %}

    {# favicons #}
    {% comment %}
        Generate favicons by http://realfavicongenerator.net and select the option to serve files up from the root of the site.
        Place all the files generated by realfavicon generator in the "public" folder in the application root, and they will be served up from the root of the site by whitenoise.
    {% endcomment %}
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    {% comment %}
        Twitter summary card - see https://dev.twitter.com/cards/types/summary
        and https://dev.twitter.com/cards/getting-started
    {% endcomment %}
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@{{ settings.utils.SocialMediaSettings.twitter_handle }}" />
    <meta name="twitter:title" content="{{ page.title }}" />
    <meta name="twitter:description" content="{{ page|social_text:current_site }}">

    {% static 'images/bc-logo-high-res.png' as logo_image %}
    {% image page.social_image original as social_image %}
    {% firstof social_image.url logo_image as social_image_url %}
    {% with social_image_url=current_site.root_url|add:social_image_url %}
        <meta name="twitter:image" content="{{ social_image_url }}">

        {# facebook opengraph tags #}
        <meta property="fb:app_id" content="{{ settings.utils.SocialMediaSettings.facebook_app_id }}" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="{{ page.url }}" />
        <meta property="og:title" content="{{ page.title }}" />
        <meta property="og:image" content="{{ social_image_url }}">
    {% endwith %}
    <meta property="og:description" content="{{ page|social_text:current_site }}" />
    <meta property="og:site_name" content="{{ settings.utils.SocialMediaSettings.site_name }}" />
{% endblock meta_tags %}


{% block body_top %}
    {% if GOOGLE_TAG_MANAGER_ID %}
        {% include "patterns/pages/includes/GTM/noscript_body.html" %}
    {% endif %}
{% endblock body_top %}

{% block body_bottom %}
    {% if FATHOM_SITE_ID %}
        <!-- Fathom - simple website analytics - https://usefathom.com -->
        <script>
        (function(f, a, t, h, o, m){
        a[h]=a[h]||function(){
        (a[h].q=a[h].q||[]).push(arguments)
        };
        o=f.createElement('script'),
        m=f.getElementsByTagName('script')[0];
        o.async=1; o.src=t; o.id='fathom-script';
        m.parentNode.insertBefore(o,m)
        })(document, window, 'https://cdn.usefathom.com/tracker.js', 'fathom');
        fathom('set', 'siteId', '{{ FATHOM_SITE_ID }}');
        fathom('trackPageview');
        </script>
        <!-- / Fathom -->
    {% endif %}
{% endblock body_bottom %}

{% block header %}
    {% include "patterns/molecules/skip-link/skip-link.html" %}

    {% include "patterns/molecules/cookie-message/cookie-message.html" %}

    {% include "patterns/organisms/header/header.html" with show_search=True %}
{% endblock header %}

{% block alerts %}
    {% get_alerts page as alerts %}
    {% if alerts %}
        <div class="wrapper wrapper--large wrapper--margin">
        {% for alert in alerts %}
            {% include "patterns/molecules/alerts/alert-message-sitewide.html" with alert_id=forloop.counter %}
        {% endfor %}
        </div>
    {% endif %}
{% endblock alerts %}

{% block footer %}
    {% include "patterns/organisms/footer/footer.html" %}
{% endblock footer %}
